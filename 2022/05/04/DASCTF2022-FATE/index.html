<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>DASCTF2022-FATE | Gruge's Blog</title><meta name="keywords" content="md5,SHA1,Wincrpt解密AES,APK加固,APK脱壳(blackdex),pyc文件解包(pyinstxtractor),pyz文件解密,pyc文件反编译(pycdc工具),RSA低解密指数攻击"><meta name="author" content="Gruge"><meta name="copyright" content="Gruge"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CrackMeMFC的逆向分析CracckMe,写题的时候在网上搜到了逆向分析CrackMe 这篇文章，通过OD+IDA的方式定位到关键代码处，然后进行解密的操作。 知识点： MD5 Sha1 Hashcat Wincrpt 定位关键函数OD来定位关键代码和提取数据，因为这个程序有反调试，而OD之中有插件，能够很好的反反调试而提取相关的数据。 IDA能够很好的反编译相应的代码，搞清楚函数的逻辑。">
<meta property="og:type" content="article">
<meta property="og:title" content="DASCTF2022-FATE">
<meta property="og:url" content="http://example.com/2022/05/04/DASCTF2022-FATE/index.html">
<meta property="og:site_name" content="Gruge's Blog">
<meta property="og:description" content="CrackMeMFC的逆向分析CracckMe,写题的时候在网上搜到了逆向分析CrackMe 这篇文章，通过OD+IDA的方式定位到关键代码处，然后进行解密的操作。 知识点： MD5 Sha1 Hashcat Wincrpt 定位关键函数OD来定位关键代码和提取数据，因为这个程序有反调试，而OD之中有插件，能够很好的反反调试而提取相关的数据。 IDA能够很好的反编译相应的代码，搞清楚函数的逻辑。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg">
<meta property="article:published_time" content="2022-05-04T09:44:12.000Z">
<meta property="article:modified_time" content="2022-05-04T09:54:38.729Z">
<meta property="article:author" content="Gruge">
<meta property="article:tag" content="md5">
<meta property="article:tag" content="SHA1">
<meta property="article:tag" content="Wincrpt解密AES">
<meta property="article:tag" content="APK加固">
<meta property="article:tag" content="APK脱壳(blackdex)">
<meta property="article:tag" content="pyc文件解包(pyinstxtractor)">
<meta property="article:tag" content="pyz文件解密">
<meta property="article:tag" content="pyc文件反编译(pycdc工具)">
<meta property="article:tag" content="RSA低解密指数攻击">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/05/04/DASCTF2022-FATE/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DASCTF2022-FATE',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-04 17:54:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/modify.css"><meta name="generator" content="Hexo 5.4.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/463b631c6a0f63ec.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Gruge's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DASCTF2022-FATE</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-04T09:44:12.000Z" title="发表于 2022-05-04 17:44:12">2022-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-04T09:54:38.729Z" title="更新于 2022-05-04 17:54:38">2022-05-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%8D%E7%8E%B0/">复现</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="DASCTF2022-FATE"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg');"></div><article class="post-content" id="article-container"><h2 id="CrackMe"><a href="#CrackMe" class="headerlink" title="CrackMe"></a>CrackMe</h2><p>MFC的逆向分析CracckMe,写题的时候在网上搜到了<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-221038.htm">逆向分析CrackMe</a> 这篇文章，通过OD+IDA的方式定位到关键代码处，然后进行解密的操作。</p>
<p>知识点： MD5 Sha1 Hashcat Wincrpt</p>
<h3 id="定位关键函数"><a href="#定位关键函数" class="headerlink" title="定位关键函数"></a>定位关键函数</h3><p>OD来定位关键代码和提取数据，因为这个程序有反调试，而OD之中有插件，能够很好的反反调试而提取相关的数据。</p>
<p>IDA能够很好的反编译相应的代码，搞清楚函数的逻辑。</p>
<p>搜索MessageBoxA，因为当输入flag和key之后，输入错误会弹出弹窗，而MessageBoxA 有可能是表示弹窗的函数位置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426200327902.png" alt="image-20220426200327902"></p>
<p><strong>（Ctrl+G）跟踪表达式【TextA/W】</strong> 就找到引用这个函数的地址，看到这个地址之后，发现它的下方就是“Wrong!!!“字符串，就找到对应输出Wrong的这个函数的位置，</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423131904713.png" alt="image-20220423131904713"></p>
<p>定位到输出wrong!!!的代码处</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423132053957.png" alt="image-20220423132053957"></p>
<p>并且在它的下面就是输出successful的代码处</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423132133014.png" alt="image-20220423132133014"></p>
<p>在ida之中能更加容易的分析代码，所以通过这两个输出wrong和Success的地址，在ida之中定位到这两个函数，并且通过他们向上就找（交叉引用的方法）到对输入的key和flag进行验证的函数。</p>
<p>关键函数的位置:0x4C31E0</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423140534625.png" alt="image-20220423140534625"></p>
<h3 id="分析关键函数逻辑"><a href="#分析关键函数逻辑" class="headerlink" title="分析关键函数逻辑"></a>分析关键函数逻辑</h3><p>这里将key分成了两部分进行加密，前4个字节使用MD5加密，后4个字节使用Sha1加密，key的md5加密的结果会作为AES加密的密钥，flag的加密是AES加密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426201914088.png" alt="image-20220426201914088"></p>
<h4 id="4个加密函数"><a href="#4个加密函数" class="headerlink" title="4个加密函数"></a>4个加密函数</h4><p>这里有4个加密的函数，在每个函数的里面都是调用<strong>Wincrypt</strong>的函数来进行加密的操作，但当时我做的时候完全没有注意到这个点，都是通过加密之后的长度来判断用的是什么加密（所以把key解密出来了），不然也不至于最后一步没有解出来。</p>
<p>所以自己以后对于这种情况，要查明这里面调用的函数中引用的参数表示什么意思，有什么作用！！！！！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220425204459582.png" alt="image-20220425204459582"></p>
<p>Algid 的数值：将输入的8个字节的key分成两个部分，前4个字节用md5加密，后4个字节用Sha1加密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220425205856887.png" alt="image-20220425205856887"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220425205920813.png" alt="image-20220425205920813"></p>
<p>所以第一个是对输入的flag进行md5的hash加密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423135349916.png" alt="image-20220423135349916"></p>
<h4 id="提取加密结果的数据（OD）"><a href="#提取加密结果的数据（OD）" class="headerlink" title="提取加密结果的数据（OD）"></a>提取加密结果的数据（OD）</h4><p>加密结果的对比的函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423175915409.png" alt="image-20220423175915409"></p>
<p>三个对比加密数据的汇编代码处</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423142415880.png" alt="image-20220423142415880"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423142438993.png" alt="image-20220423142438993"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423142505141.png" alt="image-20220423142505141"></p>
<p>通过ida之中三个对输入的加密结果判断的函数的地址，在od之中对应的地址下断点，动调调试找到对比的数据（密文）</p>
<h3 id="md5解密"><a href="#md5解密" class="headerlink" title="md5解密"></a>md5解密</h3><p>第一组（md5） =》 找个<a target="_blank" rel="noopener" href="https://www.cmd5.com/">在线网址</a>解密</p>
<p>数据地址009AF460</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423143845071.png" alt="image-20220423143845071"></p>
<p>密文：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">009AF460  9F 77 C2 A4 AC 5C 0A 67  焪陇琝.g</span><br><span class="line">009AF468  13 21 BB E1 E9 97 2A F6  !会闂*?</span><br></pre></td></tr></tbody></table></figure>

<p>   密文：9F77C2A4AC5C0A671321BBE1E9972AF6   明文：NocT</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426202804265.png" alt="image-20220426202804265"></p>
<h3 id="SHA1解密"><a href="#SHA1解密" class="headerlink" title="SHA1解密"></a>SHA1解密</h3><p>第二组（SHA1）=》(使用<a target="_blank" rel="noopener" href="https://github.com/hashcat/hashcat">HashCat</a>解密) <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4008">Hashcat使用手册</a></p>
<p>长度是：20</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423155222571.png" alt="image-20220423155222571"></p>
<p>密文：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">010FF59C  D5 9F 8E 94 B0 E1 DE 6E  諢帞搬辬</span><br><span class="line">010FF5A4  32 95 18 A0 C4 44 AA 94  2?犇D獢</span><br><span class="line">010FF5AC  DE 7C 8D 44              迀岲..</span><br></pre></td></tr></tbody></table></figure>

<p>密文：d59f8e94b0e1de6e329518a0c444aa94de7c8d44 明文：uRne</p>
<p>所以key的值就是： NocTuRne </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423165125938.png" alt="image-20220423165125938"></p>
<p>最后得到的key： NocTuRne</p>
<h3 id="Wincrpt解密AES"><a href="#Wincrpt解密AES" class="headerlink" title="Wincrpt解密AES"></a>Wincrpt解密AES</h3><p>第三组（AES）</p>
<p>长度是 0x30</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220423165627288.png" alt="image-20220423165627288"></p>
<p>密文：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">003AFC20  5B 9C EE B2 3B B7 D7 34  [滎?纷4</span><br><span class="line">003AFC28  F3 1B 75 14 C6 B2 1F E8  ?u撇?</span><br><span class="line">003AFC30  DE 33 44 74 75 1B 47 6A  ?DtuGj</span><br><span class="line">003AFC38  D4 37 51 88 FC 67 E6 60  ?Q堻g鎌</span><br><span class="line">003AFC40  DA 0D 58 07 81 43 53 EA  ?X丆S?</span><br><span class="line">003AFC48  7B 52 85 6C 86 65 AF B4  {R卨唀</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x5B,0x9C,0xEE,0xB2,0x3B,0xB7,0xD7,0x34,0xF3,0x1B,0x75,0x14,0xC6,0xB2,0x1F,0xE8,0xDE,0x33,0x44,0x74,0x75,0x1B,0x47,0x6A,0xD4,0x37,0x51,0x88,0xFC,0x67,0xE6,0x60,0xDA,0x0D,0x58,0x07,0x81,0x43,0x53,0xEA,0x7B,0x52,0x85,0x6C,0x86,0x65,0xAF,0xB4</span><br></pre></td></tr></tbody></table></figure>

<p>AES的密钥：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x5c,0x53,0xa4,0xa4,0x1d,0x52,0x43,0x7a,0x9f,0xa1,0xe9,0xc2,0x6c,0xa5,0x90,0x90</span><br></pre></td></tr></tbody></table></figure>

<p>我实在是没有想到啊，最后这一步居然是AES解密</p>
<h4 id="Wincrpt"><a href="#Wincrpt" class="headerlink" title="Wincrpt"></a>Wincrpt</h4><p>最后一步直接使用Wincrpt中的CryptEncrypt对应的CryptDecrypt这个函数来进行解密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426133237250.png" alt="image-20220426133237250"></p>
<h4 id="CryptDecrypt的讲解"><a href="#CryptDecrypt的讲解" class="headerlink" title="CryptDecrypt的讲解"></a>CryptDecrypt的讲解</h4><p>在调用<strong>CryptEncrypt之前，应用程序必须通过调用</strong><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wincrypt/nf-wincrypt-cryptcreatehash">CryptCreateHash</a>函数获取散列对象的 句柄。<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wincrypt/nf-wincrypt-cryptsignhasha">加密完成后，可以使用CryptGetHashParam</a>函数获取哈希值，也可以使用 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/desktop/api/wincrypt/nf-wincrypt-cryptgethashparam">CryptSignHash</a>函数对哈希进行签名 。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">BOOL CryptEncrypt(</span><br><span class="line">  [in]      HCRYPTKEY  hKey,</span><br><span class="line">  [in]      HCRYPTHASH hHash,</span><br><span class="line">  [in]      BOOL       Final,</span><br><span class="line">  [in]      DWORD      dwFlags,</span><br><span class="line">  [in, out] BYTE       *pbData,</span><br><span class="line">  [in, out] DWORD      *pdwDataLen,</span><br><span class="line">  [in]      DWORD      dwBufLen</span><br><span class="line">);</span><br><span class="line">[in] hKey: 用于解密的密钥句柄。</span><br><span class="line">[in] hHash: 哈希对象的句柄。如果要同时解密和散列数据，则在此参数中传递散列对象的句柄。散列值用解密后的明文更新。此选项在同时解密             和验证签名时很有用。如果不进行散列，则此参数必须为零。</span><br><span class="line">[in] Final: 一个布尔值，指定这是否是正在解密的系列中的最后一部分。如果这是最后一个或唯一一个块，则此值为TRUE 。如果这不是最后一             个块，则此值为FALSE。        </span><br><span class="line">[in] dwFlags: 标志值</span><br><span class="line">[in, out] pbData： 指向包含要加密的明文的缓冲区的指针。此缓冲区中的明文被此函数创建的密文覆盖。</span><br><span class="line">[in, out] pdwDataLen： 一个指向DWORD值的指针，该值在输入时包含pbData缓冲区中明文的长度（以字节为单位）。退出时，此DWORD包含                        写入pbData缓冲区的密文的长度（以字节为单位）。</span><br><span class="line">[in] dwBufLen： 指定输入pbData缓冲区的总大小（以字节为单位） 。</span><br></pre></td></tr></tbody></table></figure>

<h4 id="CryptDecrypt的讲解-1"><a href="#CryptDecrypt的讲解-1" class="headerlink" title="CryptDecrypt的讲解"></a>CryptDecrypt的讲解</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BOOL CryptDecrypt(</span><br><span class="line">  [in]      HCRYPTKEY  hKey,</span><br><span class="line">  [in]      HCRYPTHASH hHash,</span><br><span class="line">  [in]      BOOL       Final,</span><br><span class="line">  [in]      DWORD      dwFlags,</span><br><span class="line">  [in, out] BYTE       *pbData,</span><br><span class="line">  [in, out] DWORD      *pdwDataLen</span><br><span class="line">);</span><br><span class="line">hkey: 用于解密的密钥句柄,此密钥指定要使用的解密算法</span><br><span class="line">[in] hHash: 哈希对象的句柄。如果要同时解密和散列数据，则在此参数中传递散列对象的句柄。散列值用解密后的明文更新。此选项在同时解密             和验证签名时很有用。如果不进行散列，则此参数必须为零。</span><br><span class="line">[in] Final: 一个布尔值，指定这是否是正在解密的系列中的最后一部分。如果这是最后一个或唯一一个块，则此值为TRUE 。如果这不是最后一             个块，则此值为FALSE。</span><br><span class="line">[in] dwFlags: 标志值(见下图)</span><br><span class="line">[in, out] pbData： 指向包含要解密的数据的缓冲区的指针。解密完成后，明文被放回同一个缓冲区。</span><br><span class="line">[in, out] pdwDataLen： 指向指示pbData缓冲区长度的DWORD值的指针。在调用此函数之前，调用应用程序将DWORD值设置为要解密的字节                        数。返回时，DWORD值包含解密后的明文的字节数。</span><br></pre></td></tr></tbody></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426132654399.png" alt="image-20220426132654399" style="zoom: 67%;">

<h4 id="解密脚本"><a href="#解密脚本" class="headerlink" title="解密脚本"></a>解密脚本</h4><p>这里调用了CryptEncrypt进行AES的加密的操作，所以这里我们直接使用CryptDecrypt来解密就可以了，可以直接从网上去找用它来<a target="_blank" rel="noopener" href="https://www.writebug.com/git/DemonGan/CryptoApi">解密的脚本</a>，也可以直接把加密的函数脱出来，将里面CryptEncrypt函数修改成CryptDecrypt函数就可以了（两个脚本的逻辑都是一样的）</p>
<p>第一种脚本：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;tchar.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;wincrypt.h&gt;</span><br><span class="line">#include &lt;conio.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">      BOOL v6; // [esp+4h] [ebp-18h]</span><br><span class="line">  HCRYPTKEY phKey; // [esp+Ch] [ebp-10h] BYREF</span><br><span class="line">  HCRYPTPROV phProv; // [esp+10h] [ebp-Ch] BYREF</span><br><span class="line">  HCRYPTHASH phHash; // [esp+14h] [ebp-8h] BYREF</span><br><span class="line"></span><br><span class="line">  phProv = 0;</span><br><span class="line">  phHash = 0;</span><br><span class="line">  phKey = 0;</span><br><span class="line">  BYTE a3[] = {0x5B,0x9C,0xEE,0xB2,0x3B,0xB7,0xD7,0x34,0xF3,0x1B,0x75,0x14,0xC6,0xB2,0x1F,0xE8,0xDE,0x33,0x44,0x74,0x75,0x1B,0x47,0x6A,0xD4,0x37,0x51,0x88,0xFC,0x67,0xE6,0x60,0xDA,0x0D,0x58,0x07,0x81,0x43,0x53,0xEA,0x7B,0x52,0x85,0x6C,0x86,0x65,0xAF,0xB4};</span><br><span class="line">  BYTE pbData[] ={0x5c,0x53,0xa4,0xa4,0x1d,0x52,0x43,0x7a,0x9f,0xa1,0xe9,0xc2,0x6c,0xa5,0x90,0x90};</span><br><span class="line">  DWORD dwDataLen = 0x10;</span><br><span class="line">  DWORD *pdwDataLen ;</span><br><span class="line">  *pdwDataLen = 0x20;</span><br><span class="line">  v6 = CryptAcquireContextA(&amp;phProv, 0, 0, 0x18u, 0xF0000000);</span><br><span class="line">  if ( v6 )</span><br><span class="line">  {</span><br><span class="line">    v6 = CryptCreateHash(phProv, 0x8003u, 0, 0, &amp;phHash);</span><br><span class="line">    if ( v6 )</span><br><span class="line">    {</span><br><span class="line">      v6 = CryptHashData(phHash, pbData, dwDataLen, 0);</span><br><span class="line">      if ( v6 )</span><br><span class="line">      {</span><br><span class="line">        v6 = CryptDeriveKey(phProv, 0x660Eu, phHash, 1u, &amp;phKey);</span><br><span class="line">        if ( v6 )</span><br><span class="line">          v6 = CryptDecrypt(phKey, 0, 1, 0, a3, pdwDataLen);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">cout&lt;&lt;a3&lt;&lt;endl;</span><br><span class="line">  if ( phKey )</span><br><span class="line">    CryptDestroyKey(phKey);</span><br><span class="line">  if ( phHash )</span><br><span class="line">    CryptDestroyHash(phHash);</span><br><span class="line">  if ( phProv )</span><br><span class="line">    CryptReleaseContext(phProv, 0);</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>第二种脚本：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;windef.h&gt;</span><br><span class="line">#include &lt;wincrypt.h&gt;</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">BOOL AesDecrypt()</span><br><span class="line">{</span><br><span class="line">	BOOL bRet = TRUE;</span><br><span class="line">	HCRYPTPROV hCryptProv = NULL;</span><br><span class="line">	HCRYPTHASH hCryptHash = NULL;</span><br><span class="line">	HCRYPTKEY hCryptKey = NULL;</span><br><span class="line"></span><br><span class="line">	BYTE pPassword[] = { 0x5c,0x53,0xa4,0xa4,0x1d,0x52,0x43,0x7a,0x9f,0xa1,0xe9,0xc2,0x6c,0xa5,0x90,0x90 };</span><br><span class="line">    DWORD dwPasswordLength = 0x10;</span><br><span class="line">    BYTE pData[] = { 0x5B, 0x9C, 0xEE, 0xB2, 0x3B, 0xB7, 0xD7, 0x34, 0xF3, 0x1B, 0x75, 0x14, 0xC6, 0xB2, 0x1F, 0xE8, 0xDE, 0x33, 0x44, 0x74, 0x75, 0x1B, 0x47, 0x6A, 0xD4, 0x37, 0x51, 0x88, 0xFC, 0x67, 0xE6, 0x60, 0xDA, 0x0D, 0x58, 0x07, 0x81, 0x43, 0x53, 0xEA, 0x7B, 0x52, 0x85, 0x6C, 0x86, 0x65, 0xAF, 0xB4 };</span><br><span class="line">	DWORD dwDataLength = 0x20;</span><br><span class="line">	DWORD dwBufferLength = 0x108;</span><br><span class="line">	do</span><br><span class="line">	{</span><br><span class="line">		// 获取CSP句柄</span><br><span class="line">		bRet = ::CryptAcquireContext(&amp;hCryptProv, NULL, NULL, PROV_RSA_AES, CRYPT_VERIFYCONTEXT);</span><br><span class="line">		if (FALSE == bRet)</span><br><span class="line">		{</span><br><span class="line"></span><br><span class="line">			break;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		// 创建HASH对象</span><br><span class="line">		bRet = ::CryptCreateHash(hCryptProv, CALG_MD5, NULL, 0, &amp;hCryptHash);</span><br><span class="line">		if (FALSE == bRet)</span><br><span class="line">		{</span><br><span class="line"></span><br><span class="line">			break;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		// 对密钥进行HASH计算</span><br><span class="line">		bRet = ::CryptHashData(hCryptHash, pPassword, dwPasswordLength, 0);</span><br><span class="line">		if (FALSE == bRet)</span><br><span class="line">		{</span><br><span class="line"></span><br><span class="line">			break;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		// 使用HASH来生成密钥</span><br><span class="line">		bRet = ::CryptDeriveKey(hCryptProv, CALG_AES_128, hCryptHash, CRYPT_EXPORTABLE, &amp;hCryptKey);</span><br><span class="line">		if (FALSE == bRet)</span><br><span class="line">		{</span><br><span class="line"></span><br><span class="line">			break;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		// 解密数据</span><br><span class="line">		bRet = ::CryptDecrypt(hCryptKey, NULL, TRUE, 0, pData, &amp;dwDataLength);</span><br><span class="line">		if (FALSE == bRet)</span><br><span class="line">		{</span><br><span class="line"></span><br><span class="line">			break;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">	} while (FALSE);</span><br><span class="line">cout&lt;&lt;pData&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">	// 关闭释放</span><br><span class="line">	if (hCryptKey)</span><br><span class="line">	{</span><br><span class="line">		::CryptDestroyKey(hCryptKey);</span><br><span class="line">	}</span><br><span class="line">	if (hCryptHash)</span><br><span class="line">	{</span><br><span class="line">		::CryptDestroyHash(hCryptHash);</span><br><span class="line">	}</span><br><span class="line">	if (hCryptProv)</span><br><span class="line">	{</span><br><span class="line">		::CryptReleaseContext(hCryptProv, 0);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	return bRet;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">{</span><br><span class="line">    AesDecrypt();</span><br><span class="line">    return 0;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>最后解得的结果是：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426195628830.png" alt="image-20220426195628830"></p>
<p>最后的flag ：DASCTF{H@sh_a^d_Aes_6y_W1nCrypt}</p>
<h2 id="fakePica"><a href="#fakePica" class="headerlink" title="fakePica"></a>fakePica</h2><p>先用PKID查壳，太久没做APK的题目，当时做的时候都忘了进行查壳了，以后一定要注意，不要直接就jeb里面拖</p>
<p>可以看到这是一个梆梆加固</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426205532076.png" alt="image-20220426205532076"></p>
<h3 id="分析APK加固的方法"><a href="#分析APK加固的方法" class="headerlink" title="分析APK加固的方法"></a>分析APK加固的方法</h3><p>这里讲述的是通过反编译代码分析是梆梆加固的过程</p>
<p>先用jeb打开文件，在文件的主函数之中并没有找到MainActivity，但是发现引入了有关AppAplication的包，就可以猜测加了壳</p>
<p>再用APKTool得到程序的相关的文件，查看lib文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426210811471.png" alt="image-20220426210811471"></p>
<p>这两个so文件就是梆梆加固的so文件（通过下面lib文件和对应的加固方法的字典就能知道），可以用python写一个脚本来辨认</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">markNameMap.put("libchaosvmp.so", "娜迦");</span><br><span class="line">markNameMap.put("libddog.so", "娜迦");</span><br><span class="line">markNameMap.put("libfdog.so", "娜迦");</span><br><span class="line">markNameMap.put("libedog.so", "娜迦企业版");</span><br><span class="line">markNameMap.put("libexec.so", "爱加密");</span><br><span class="line">markNameMap.put("libexecmain.so", "爱加密");</span><br><span class="line">markNameMap.put("ijiami.dat", "爱加密");</span><br><span class="line">markNameMap.put("ijiami.ajm", "爱加密企业版");</span><br><span class="line">markNameMap.put("libsecexe.so", "梆梆免费版");</span><br><span class="line">markNameMap.put("libsecmain.so", "梆梆免费版");</span><br><span class="line">markNameMap.put("libSecShell.so", "梆梆免费版");</span><br><span class="line">markNameMap.put("libDexHelper.so", "梆梆企业版");</span><br><span class="line">markNameMap.put("libDexHelper-x86.so", "梆梆企业版");</span><br><span class="line">markNameMap.put("libprotectClass.so", "360");</span><br><span class="line">markNameMap.put("libjiagu.so", "360");</span><br><span class="line">markNameMap.put("libjiagu_art.so", "360");</span><br><span class="line">markNameMap.put("libjiagu_x86.so", "360");</span><br><span class="line">markNameMap.put("libegis.so", "通付盾");</span><br><span class="line">markNameMap.put("libNSaferOnly.so", "通付盾");</span><br><span class="line">markNameMap.put("libnqshield.so", "网秦");</span><br><span class="line">markNameMap.put("libbaiduprotect.so", "百度");</span><br><span class="line">markNameMap.put("aliprotect.dat", "阿里聚安全");</span><br><span class="line">markNameMap.put("libsgmain.so", "阿里聚安全");</span><br><span class="line">markNameMap.put("libsgsecuritybody.so", "阿里聚安全");</span><br><span class="line">markNameMap.put("libmobisec.so", "阿里聚安全");</span><br><span class="line">markNameMap.put("libtup.so", "腾讯");</span><br><span class="line">markNameMap.put("libexec.so", "腾讯");</span><br><span class="line">markNameMap.put("libshell.so", "腾讯");</span><br><span class="line">markNameMap.put("mix.dex", "腾讯");</span><br><span class="line">markNameMap.put("lib/armeabi/mix.dex", "腾讯");</span><br><span class="line">markNameMap.put("lib/armeabi/mixz.dex", "腾讯");</span><br><span class="line">markNameMap.put("libtosprotection.armeabi.so", "腾讯御安全");</span><br><span class="line">markNameMap.put("libtosprotection.armeabi-v7a.so", "腾讯御安全");</span><br><span class="line">markNameMap.put("libtosprotection.x86.so", "腾讯御安全");</span><br><span class="line">markNameMap.put("libnesec.so", "网易易盾");</span><br><span class="line">markNameMap.put("libAPKProtect.so", "APKProtect");</span><br><span class="line">markNameMap.put("libkwscmm.so", "几维安全");</span><br><span class="line">markNameMap.put("libkwscr.so", "几维安全");</span><br><span class="line">markNameMap.put("libkwslinker.so", "几维安全");</span><br><span class="line">markNameMap.put("libx3g.so", "顶像科技");</span><br><span class="line">markNameMap.put("libapssec.so", "盛大");</span><br><span class="line">markNameMap.put("librsprotect.so", "瑞星");</span><br></pre></td></tr></tbody></table></figure>

<h3 id="blackdex-APK脱壳"><a href="#blackdex-APK脱壳" class="headerlink" title="blackdex-APK脱壳"></a>blackdex-APK脱壳</h3><p>使用<a target="_blank" rel="noopener" href="https://github.com/CodingGay/BlackDex">blackdex</a>软件进行脱壳</p>
<h4 id="判断32位还是64位的APK文件"><a href="#判断32位还是64位的APK文件" class="headerlink" title="判断32位还是64位的APK文件"></a>判断32位还是64位的APK文件</h4><p>首先判断一个APK是32位还是64位的</p>
<p>32位和64的架构</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426213154347.png" alt="image-20220426213154347"></p>
<p>查看lib文件夹</p>
<p>这里是armeabi-v7a 就说明是32位的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426213235800.png" alt="image-20220426213235800"></p>
<p>所以运行32位的blackdex（将对应位数的blackdex的apk文件放入模拟器之中）,将需要脱壳的apk文件也拖入模拟器之中，运行脱壳的Apk文件，在这个程序之中选中需要脱壳的这个软件，就可以直接脱壳了，它脱壳完成之后将脱壳得到的dex文件存入下面这个文件目录之中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426213832469.png" alt="image-20220426213832469"></p>
<p>在虚拟器的文件管理之中打开该文件夹，并且选中该文件夹（这个文件夹之中有4个dex文件），再打开共享文件夹，在共享文件夹的地方选中图中选项</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426215804244.png" alt="image-20220426215804244"></p>
<p>共享文件打开的地方：（高级功能之中能够对电脑端的共享文件夹进行重新的设置）</p>
<p>这样达到的效果就是电脑端的该文件夹和模拟器端的该文件夹是同步的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426215837100.png" alt="image-20220426215837100"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220426215849767.png" alt="image-20220426215849767"></p>
<h3 id="分析脱壳得到的dex文件"><a href="#分析脱壳得到的dex文件" class="headerlink" title="分析脱壳得到的dex文件"></a>分析脱壳得到的dex文件</h3><p>将这些dex文件拖进jeb之中分析：</p>
<blockquote>
<p>dex文件：</p>
<ul>
<li><p>dex文件是Android系统的可执行文件，包含应用程序的全部操作指令以及运行时数据。</p>
</li>
<li><p>当java程序编译成class后，还需要使用dex工具将所有的class文件整合到一个dex文件，目的是其中各个类能够共享数据，在一定程度上降低了冗余，同时也是文件结构更加经凑，dex文件是传统jar文件大小的50％左右。</p>
</li>
<li><p>dex文件的作用是记录整个工程（通常是一个Android工程）的所有类文件的信息。</p>
</li>
</ul>
</blockquote>
<p>逐个打开每个dex文件，在cookie_8836564.dex文件之中找到MainActivity函数</p>
<h4 id="AES解密"><a href="#AES解密" class="headerlink" title="AES解密"></a>AES解密</h4><p>打开这个mainActivity这个类就能很直观的看到用的是AES加密，并且是直接调用的Java的接口，所以就是标准的AES解密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427092404661.png" alt="image-20220427092404661"></p>
<p>AES的 key = “picapicapicapica” </p>
<p>AES的 IV向量 IV = “0102030405060708”</p>
<p>第一组的密文</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-114, 0x5F, -37, 0x7F, -110, 0x71, 41, 74, 40, 73, 19, 0x7C, -57, -88, 39, -116, -16, -75, -3, -45, -73, -6, -104, -6, -78, 0x79, 110, 74, -90, -47, -28, -28</span><br><span class="line"></span><br><span class="line">0x8e,0x5f,0xdb,0x7f,0x92,0x71,0x29,0x4a,0x28,0x49,0x13,0x7c,0xc7,0xa8,0x27,0x8c,0xf0,0xb5,0xfd,0xd3,0xb7,0xfa,0x98,0xfa,0xb2,0x79,0x6e,0x4a,0xa6,0xd1,0xe4,0xe4</span><br><span class="line"></span><br><span class="line">8e5fdb7f9271294a2849137cc7a8278cf0b5fdd3b7fa98fab2796e4aa6d1e4e4</span><br><span class="line"></span><br><span class="line">明文： picacomic@gmail.com</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427003406872.png" alt="image-20220427003406872"></p>
<p>第二组的密文：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-40, 26, 0x5F, -49, -40, -123, 72, -90, -100, -41, 0x7A, -4, 25, -101, -58, 0x74</span><br><span class="line"></span><br><span class="line">0xd8,0x1a,0x5f,0xcf,0xd8,0x85,0x48,0xa6,0x9c,0xd7,0x7a,0xfc,0x19,0x9b,0xc6,0x74</span><br><span class="line"></span><br><span class="line">明文： picacomic</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427003510166.png" alt="image-20220427003510166"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427003744579.png" alt="image-20220427003744579"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427003747472.png" alt="image-20220427003747472"></p>
<p>flag{<a href="mailto:picacomic@gmail.compicacomic">picacomic@gmail.compicacomic</a>}</p>
<h2 id="奇怪的交易"><a href="#奇怪的交易" class="headerlink" title="奇怪的交易"></a>奇怪的交易</h2><p>当时用ida打开这个文件的时候就发现这个文件里面怎么提到了python的东西，当时还以为是在c语言之中运行python文件，结果发现是用python来打包elf文件，自己平时知识点的积累还是太少了</p>
<p><a target="_blank" rel="noopener" href="https://lu1u.xyz/">Lu1u师傅</a> </p>
<p>使用pyinstxtractor解包就得到了对应的pyc文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427135100720.png" alt="image-20220427135100720"></p>
<h3 id="pyc文件以及其中的pyz文件解包"><a href="#pyc文件以及其中的pyz文件解包" class="headerlink" title="pyc文件以及其中的pyz文件解包"></a>pyc文件以及其中的pyz文件解包</h3><p>这个地方用<a target="_blank" rel="noopener" href="https://github.com/extremecoders-re/pyinstxtractor/wiki/Frequently-Asked-Questions">pyinstxtractor解包</a>源文件的时候要使用python3.10的环境运行这个pyinstxtractor.py文件。这样pyz文件解包的文件才能够在PYZ-00.pyz_extracted文件夹之中获得</p>
<p>安装和使用Miniconda3 这个软件的作用是用来管理环境的（这里用来在本机上配置python3.10环境）</p>
<p><a target="_blank" rel="noopener" href="https://docs.conda.io/en/latest/miniconda.html">下载的地址</a></p>
<p><a target="_blank" rel="noopener" href="https://ywnz.com/linuxjc/3834.html">安装和卸载的地址</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/133494097">使用软件</a></p>
<p>如何判断这个文件打包的时候使用的是python版本的是3.10的呢？</p>
<p>答：随便使用一个版本的pyinstxtractor来解包文件，通过它的依赖文件就可以进行判断</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220502181556493.png" alt="image-20220502181556493"></p>
<p>这道题目的python版本是3.10，它的magic的num可以通过struct.pyc文件的前4个字节获得，或者通过PYZ-00.pyz文件的5到8字节数据能够得到</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220502181645404.png" alt="image-20220502181645404"></p>
<p>用这个magic number将pyc文件补全（因为在打包文件的时候常常会将pyc文件的magic number去掉，我们在恢复的时候需要自己去补全，补全之后就能够进行反编译了，但是这里反编译因为是python3.10，所以不能使用python-uncompyle6得到，要使用pycdc来进行反编译</p>
<p>对奇怪的交易.pyc 文件头4个字节进行重新设置</p>
<p>python3.10版本的pyc文件的文件头是 </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220427173936449.png" alt="image-20220427173936449"></p>
<p>设置完之后，用在线pyc反编译软件可以反编译，也可以使用pycdc进行反编译 ，再用pycdas得到字节码</p>
<p>对照着字节码对下面反编译的结果进行修复</p>
<ul>
<li><p>RSA低指数加密</p>
</li>
<li><p>从cpu包中引入函数encrypt()加密</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># Source Generated with Decompyle++</span><br><span class="line"># File: 奇怪的交易.pyc (Python 3.10)</span><br><span class="line"></span><br><span class="line">from cup import *</span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    flag = input('\xe8\xaf\xb7\xe8\xbe\x93\xe5\x85\xa5flag')</span><br><span class="line">    pub_key = [   0x649EE967E7916A825CC9FD3320BEABF263BEAC68C080F52824A0F521EDB6B78577EC52BF1C9E78F4BB71192F9A23F1A17AA76E5979E4D953329D3CA65FB4A71DA57412B59DFD6AEDF0191C5555D3E5F582B81B5E6B23163E9889204A81AFFDF119FE25C92F4ED59BD3285BCD7AAE14824240D2E33C5A97848F4EB7AAC203DE6330D2B4D8FF61691544FBECD120F99A157B3D2F58FA51B2887A9D06CA383C44D071314A12B17928B96F03A06E959A5AFEFA0183664F52CD32B9FC72A04B45913FCB2D5D2D3A415A14F611CF1EAC2D6C785142A8E9CC41B67A6CD85001B06EDB8CA767D367E56E0AE651491BF8A8C17A38A1835DB9E4A9292B1D86D5776C98CC25L,</span><br><span class="line">        0x647327833ACFEF1F9C83E74E171FC300FA347D4A6769476C33DA82C95120ACB38B62B33D429206FE6E9BB0BB7AB748A1036971BEA36EC47130B749C1C9FF6FE03D0F7D9FC5346EB0E575BDFA6C530AA57CD676894FC080D2DD049AB59625F4B9C78BCFD95CDCD2793E440E26E189D251121CB6EB177FEDB596409034E8B0C5BBD9BD9342235DBB226C9170EFE347FF0FD2CFF9A1F7B647CC83E4D8F005FD7125A89251C768AFE70BDD54B88116814D5030F499BCAC4673CCCC342FB4B6AC58EA5A64546DC25912B6C430529F6A7F449FD96536DE269D1A1B015A4AC6B6E46EE19DCE8143726A6503E290E4BAE6BD78319B5878981F6CFFDB3B818209341FD68BL]</span><br><span class="line">    m = libnum.s2n(flag)</span><br><span class="line">    c = str(pow(m, pub_key[1], pub_key[0]))  // RSA的公钥 pub_key[1]  模的对象pub_key[0]</span><br><span class="line">    array0 = []</span><br><span class="line">    array1 = [0xd28ed952,0x57c844df,0xd91ba938,0xf9f3bd2d,0x8ef8e43d,0x24d0a6d4,0x57e35037,0x57b9a2ea,0x3c5f16c0,0xd7821910,0x3b3d098c,0x1a22518d,0xc83555b7,0xe8dff468,0xbdbdffd,0xc5b84feb,0xd9f837c6,0x248c0bef,0x8efa4edd,0x5cc7851,0x8b4b608c,0x57b785f2,0xc0b62792,0x22c8fc3e,0xaab1c22d,0xbdb9c266,0x528335db,0xae9f9816,0xd1f40b3c,0x8206ddc3,0xc4e0badc,0xe407bd26,0x8ae5685,0x8016c6a5,0xaf4ab9d3,0x1e35204a,0x3b483e49,0x85082a0b,0xca0bc95a,0xa7be567c,0x41eb42c8,0x6aad143c,0xdfefb591,0x93346b38,0x4547158e,0x289465d1,0xaee1a7a2,0x80e574ae,0xf154f55f,0x7e755cdc,0xfcbda653,0x8e902444,0xca742e12,0xb8424071,0xb4b15ec2,0x943bfa09,0xbc97cd93,0x4ca0c180,0x2f9e8e58,0x8b58328f,0xf9822360,0xd1fd15ee,0x40398f89,0x559e65ca,0xa2d6c17e,0x59d616ed,0x1dd8eeb5,0xbd8c105,0x8e014807,0x347aaa04,0x7573b596,0xbfc6ee25,0x4540463f,0x2168859c,0x6a405498,0x9d93febe,0x4c9a89ad,0x2f041932,0x47454f1e,0xf2174a07,0x62a2dc3,0x952bfe83,0xf730ac4c,0x24cf49f1,0x3a4e5490,0x6a2f4289,0x8379d23a,0xead737ee,0xe41555fb,0x27500d24,0x99f3b244,0x5d1878b8,0x842c31a4,0x46e33b42,0xa14f3e4,0xa5ce044c,0x4ee902b9,0x31276ee4,0x1854ae7c,0xe0178482,0xf412bbbc,0x59f173e1,0x9ae5225,0xde740b00,0xb7cb64fd,0xebcadb1f,0x8eae2326,0x933c216c,0xd7d1f649,0x1cb99f66,0xa448ac16,0xbc082807,0x4b2a6481,0x7afa8587,0x8474a61d,0x60c272b,0xbc5654d1,0x669749b9,0x40470389,0xa8546b9,0xd3c5280f,0x5d597033,0x73920388,0x595d57ad,0xc59872f8,0x317471ac,0xe51502a2,0x38cc9816,0x4c81d679,0x79e45563,0xebe6a798,0xe09575cd,0xaddf4157,0xc4770191,0x1cbf464d,0x675e4574,0xdac71054,0x99807e43,0xa88d74b1,0xcb77e028,0x5b67a7bb,0xeeebc3b6,0xe7e680e5,0x10450af8,0x12eccbeb,0xc4b10cdc,0x91776399,0x1a32a98,0x63576ed2,0x6796abb9,0x2cc32a20,0x8e364d8f,0xa0985a77,0x218d8f16,0x837d6dc3]</span><br><span class="line">    i = 0</span><br><span class="line">    // 我觉得按常理来说是将数据的每四个字节为一组，</span><br><span class="line">    while i &lt; len(c):</span><br><span class="line">        tem = 0</span><br><span class="line">        for ii in c[i:i+4]:</span><br><span class="line">        	tem = (tem&lt;&lt;8)+ord(ii)   //将输入的元素的4个数按照大序端的方式排成一个数</span><br><span class="line">        array0.append(tem)  // 每四个字节的数据一起加密</span><br><span class="line">        i += 4</span><br><span class="line">        if not i &lt; len(c):  // 判断字节的长度</span><br><span class="line">            temArray = [ 54,54,54,54]</span><br><span class="line">            strLen = len(array0)</span><br><span class="line">            res = encrypt(strLen, array0, temArray)</span><br><span class="line">            if array0 == array1:</span><br><span class="line">                print('You are right!')</span><br><span class="line">                input('')</span><br><span class="line">                quit()</span><br><span class="line">            else:</span><br><span class="line">                print('Why not drink a cup of tea and have a rest?')</span><br><span class="line">    continue</span><br><span class="line">array0是输入的数据</span><br><span class="line">strLen是输入数据的长度</span><br><span class="line">temArray应该是密钥</span><br><span class="line">array1是密文</span><br></pre></td></tr></tbody></table></figure>

<p>但是因为这个反编译的代码不太正确，所以使用pycdas得到它的字节码： <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/45101508">字节码</a></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">[Code]</span><br><span class="line">    File Name: 奇怪的交易.py</span><br><span class="line">    Object Name: &lt;module&gt;</span><br><span class="line">    Arg Count: 0</span><br><span class="line">    Pos Only Arg Count: 0</span><br><span class="line">    KW Only Arg Count: 0</span><br><span class="line">    Locals: 0</span><br><span class="line">    Stack Size: 6</span><br><span class="line">    Flags: 0x00000040 (CO_NOFREE)</span><br><span class="line">    [Names]</span><br><span class="line">        'cup'</span><br><span class="line">        '__name__'</span><br><span class="line">        'input'</span><br><span class="line">        'flag'</span><br><span class="line">        'pub_key'</span><br><span class="line">        'libnum'</span><br><span class="line">        's2n'</span><br><span class="line">        'm'</span><br><span class="line">        'str'</span><br><span class="line">        'pow'</span><br><span class="line">        'c'</span><br><span class="line">        '\xe1\x98\xa1'</span><br><span class="line">        '\xe1\x98\x99'</span><br><span class="line">        'i'</span><br><span class="line">        'len'</span><br><span class="line">        '\xe1\x98\x9e'</span><br><span class="line">        'ii'</span><br><span class="line">        'ord'</span><br><span class="line">        'append'</span><br><span class="line">        '\xe1\x98\x9d'</span><br><span class="line">        '\xe1\x98\xa0'</span><br><span class="line">        'encrypt'</span><br><span class="line">        'res'</span><br><span class="line">        'print'</span><br><span class="line">        'quit'</span><br><span class="line">    [Var Names]</span><br><span class="line">    [Free Vars]</span><br><span class="line">    [Cell Vars]</span><br><span class="line">    [Constants]</span><br><span class="line">        0</span><br><span class="line">        (</span><br><span class="line">            '*'</span><br><span class="line">        )</span><br><span class="line">        '__main__'</span><br><span class="line">        True</span><br><span class="line">        '\xe8\xaf\xb7\xe8\xbe\x93\xe5\x85\xa5flag'</span><br><span class="line">        0x649EE967E7916A825CC9FD3320BEABF263BEAC68C080F52824A0F521EDB6B78577EC52BF1C9E78F4BB71192F9A23F1A17AA76E5979E4D953329D3CA65FB4A71DA57412B59DFD6AEDF0191C5555D3E5F582B81B5E6B23163E9889204A81AFFDF119FE25C92F4ED59BD3285BCD7AAE14824240D2E33C5A97848F4EB7AAC203DE6330D2B4D8FF61691544FBECD120F99A157B3D2F58FA51B2887A9D06CA383C44D071314A12B17928B96F03A06E959A5AFEFA0183664F52CD32B9FC72A04B45913FCB2D5D2D3A415A14F611CF1EAC2D6C785142A8E9CC41B67A6CD85001B06EDB8CA767D367E56E0AE651491BF8A8C17A38A1835DB9E4A9292B1D86D5776C98CC25L</span><br><span class="line">        0x647327833ACFEF1F9C83E74E171FC300FA347D4A6769476C33DA82C95120ACB38B62B33D429206FE6E9BB0BB7AB748A1036971BEA36EC47130B749C1C9FF6FE03D0F7D9FC5346EB0E575BDFA6C530AA57CD676894FC080D2DD049AB59625F4B9C78BCFD95CDCD2793E440E26E189D251121CB6EB177FEDB596409034E8B0C5BBD9BD9342235DBB226C9170EFE347FF0FD2CFF9A1F7B647CC83E4D8F005FD7125A89251C768AFE70BDD54B88116814D5030F499BCAC4673CCCC342FB4B6AC58EA5A64546DC25912B6C430529F6A7F449FD96536DE269D1A1B015A4AC6B6E46EE19DCE8143726A6503E290E4BAE6BD78319B5878981F6CFFDB3B818209341FD68BL</span><br><span class="line">        1</span><br><span class="line">        (</span><br><span class="line">        0xd28ed952,0x57c844df,0xd91ba938,0xf9f3bd2d,0x8ef8e43d,0x24d0a6d4,0x57e35037,0x57b9a2ea,0x3c5f16c0,0xd7821910,0x3b3d098c,0x1a22518d,0xc83555b7,0xe8dff468,0xbdbdffd,0xc5b84feb,0xd9f837c6,0x248c0bef,0x8efa4edd,0x5cc7851,0x8b4b608c,0x57b785f2,0xc0b62792,0x22c8fc3e,0xaab1c22d,0xbdb9c266,0x528335db,0xae9f9816,0xd1f40b3c,0x8206ddc3,0xc4e0badc,0xe407bd26,0x8ae5685,0x8016c6a5,0xaf4ab9d3,0x1e35204a,0x3b483e49,0x85082a0b,0xca0bc95a,0xa7be567c,0x41eb42c8,0x6aad143c,0xdfefb591,0x93346b38,0x4547158e,0x289465d1,0xaee1a7a2,0x80e574ae,0xf154f55f,0x7e755cdc,0xfcbda653,0x8e902444,0xca742e12,0xb8424071,0xb4b15ec2,0x943bfa09,0xbc97cd93,0x4ca0c180,0x2f9e8e58,0x8b58328f,0xf9822360,0xd1fd15ee,0x40398f89,0x559e65ca,0xa2d6c17e,0x59d616ed,0x1dd8eeb5,0xbd8c105,0x8e014807,0x347aaa04,0x7573b596,0xbfc6ee25,0x4540463f,0x2168859c,0x6a405498,0x9d93febe,0x4c9a89ad,0x2f041932,0x47454f1e,0xf2174a07,0x62a2dc3,0x952bfe83,0xf730ac4c,0x24cf49f1,0x3a4e5490,0x6a2f4289,0x8379d23a,0xead737ee,0xe41555fb,0x27500d24,0x99f3b244,0x5d1878b8,0x842c31a4,0x46e33b42,0xa14f3e4,0xa5ce044c,0x4ee902b9,0x31276ee4,0x1854ae7c,0xe0178482,0xf412bbbc,0x59f173e1,0x9ae5225,0xde740b00,0xb7cb64fd,0xebcadb1f,0x8eae2326,0x933c216c,0xd7d1f649,0x1cb99f66,0xa448ac16,0xbc082807,0x4b2a6481,0x7afa8587,0x8474a61d,0x60c272b,0xbc5654d1,0x669749b9,0x40470389,0xa8546b9,0xd3c5280f,0x5d597033,0x73920388,0x595d57ad,0xc59872f8,0x317471ac,0xe51502a2,0x38cc9816,0x4c81d679,0x79e45563,0xebe6a798,0xe09575cd,0xaddf4157,0xc4770191,0x1cbf464d,0x675e4574,0xdac71054,0x99807e43,0xa88d74b1,0xcb77e028,0x5b67a7bb,0xeeebc3b6,0xe7e680e5,0x10450af8,0x12eccbeb,0xc4b10cdc,0x91776399,0x1a32a98,0x63576ed2,0x6796abb9,0x2cc32a20,0x8e364d8f,0xa0985a77,0x218d8f16,0x837d6dc3,</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line">        4</span><br><span class="line">        8</span><br><span class="line">        (</span><br><span class="line">            54</span><br><span class="line">            54</span><br><span class="line">            54</span><br><span class="line">            54</span><br><span class="line">        )</span><br><span class="line">        'You are right!'</span><br><span class="line">        ''</span><br><span class="line">        'Why not drink a cup of tea and have a rest?'</span><br><span class="line">        None</span><br><span class="line">    [Disassembly]</span><br><span class="line">        0       LOAD_CONST              0: 0</span><br><span class="line">        2       LOAD_CONST              1: ('*',)</span><br><span class="line">        4       IMPORT_NAME             0: cup</span><br><span class="line">        6       IMPORT_STAR             </span><br><span class="line">        8       LOAD_NAME               1: __name__</span><br><span class="line">        10      LOAD_CONST              2: '__main__'</span><br><span class="line">        12      COMPARE_OP              2 (==)</span><br><span class="line">        14      POP_JUMP_IF_FALSE       119 (to 238)</span><br><span class="line">        16      NOP                     </span><br><span class="line">        18      LOAD_NAME               2: input</span><br><span class="line">        20      LOAD_CONST              4: '\xe8\xaf\xb7\xe8\xbe\x93\xe5\x85\xa5flag'</span><br><span class="line">        22      CALL_FUNCTION           1</span><br><span class="line">        24      STORE_NAME              3: flag</span><br><span class="line">        26      LOAD_CONST              5: 0x649EE967E7916A825CC9FD3320BEABF263BEAC68C080F52824A0F521EDB6B78577EC52BF1C9E78F4BB71192F9A23F1A17AA76E5979E4D953329D3CA65FB4A71DA57412B59DFD6AEDF0191C5555D3E5F582B81B5E6B23163E9889204A81AFFDF119FE25C92F4ED59BD3285BCD7AAE14824240D2E33C5A97848F4EB7AAC203DE6330D2B4D8FF61691544FBECD120F99A157B3D2F58FA51B2887A9D06CA383C44D071314A12B17928B96F03A06E959A5AFEFA0183664F52CD32B9FC72A04B45913FCB2D5D2D3A415A14F611CF1EAC2D6C785142A8E9CC41B67A6CD85001B06EDB8CA767D367E56E0AE651491BF8A8C17A38A1835DB9E4A9292B1D86D5776C98CC25L</span><br><span class="line">        28      LOAD_CONST              6: 0x647327833ACFEF1F9C83E74E171FC300FA347D4A6769476C33DA82C95120ACB38B62B33D429206FE6E9BB0BB7AB748A1036971BEA36EC47130B749C1C9FF6FE03D0F7D9FC5346EB0E575BDFA6C530AA57CD676894FC080D2DD049AB59625F4B9C78BCFD95CDCD2793E440E26E189D251121CB6EB177FEDB596409034E8B0C5BBD9BD9342235DBB226C9170EFE347FF0FD2CFF9A1F7B647CC83E4D8F005FD7125A89251C768AFE70BDD54B88116814D5030F499BCAC4673CCCC342FB4B6AC58EA5A64546DC25912B6C430529F6A7F449FD96536DE269D1A1B015A4AC6B6E46EE19DCE8143726A6503E290E4BAE6BD78319B5878981F6CFFDB3B818209341FD68BL</span><br><span class="line">        30      BUILD_LIST              2</span><br><span class="line">        32      STORE_NAME              4: pub_key</span><br><span class="line">        34      LOAD_NAME               5: libnum</span><br><span class="line">        36      LOAD_METHOD             6: s2n</span><br><span class="line">        38      LOAD_NAME               3: flag</span><br><span class="line">        40      CALL_METHOD             1</span><br><span class="line">        42      STORE_NAME              7: m</span><br><span class="line">        44      LOAD_NAME               8: str</span><br><span class="line">        46      LOAD_NAME               9: pow</span><br><span class="line">        48      LOAD_NAME               7: m</span><br><span class="line">        50      LOAD_NAME               4: pub_key</span><br><span class="line">        52      LOAD_CONST              7: 1</span><br><span class="line">        54      BINARY_SUBSCR           </span><br><span class="line">        56      LOAD_NAME               4: pub_key</span><br><span class="line">        58      LOAD_CONST              0: 0</span><br><span class="line">        60      BINARY_SUBSCR           </span><br><span class="line">        62      CALL_FUNCTION           3</span><br><span class="line">        64      CALL_FUNCTION           1</span><br><span class="line">        66      STORE_NAME              10: c</span><br><span class="line">        68      BUILD_LIST              0</span><br><span class="line">        70      STORE_NAME              11: store</span><br><span class="line">        72      BUILD_LIST              0</span><br><span class="line">        74      LOAD_CONST              8: (0xD28ED952L, 1472742623, 0xD91BA938L, 0xF9F3BD2DL, 0x8EF8E43DL, 617653972, 1474514999, 1471783658, 1012864704, 0xD7821910L, 993855884, 438456717, 0xC83555B7L, 0xE8DFF468L, 198959101, 0xC5B84FEBL, 0xD9F837C6L, 613157871, 0x8EFA4EDDL, 97286225, 0x8B4B608CL, 1471645170, 0xC0B62792L, 583597118, 0xAAB1C22DL, 0xBDB9C266L, 1384330715, 0xAE9F9816L, 0xD1F40B3CL, 0x8206DDC3L, 0xC4E0BADCL, 0xE407BD26L, 145643141, 0x8016C6A5L, 0xAF4AB9D3L, 506798154, 994590281, 0x85082A0BL, 0xCA0BC95AL, 0xA7BE567CL, 1105937096, 1789727804, 0xDFEFB591L, 0x93346B38L, 1162286478, 680814033, 0xAEE1A7A2L, 0x80E574AEL, 0xF154F55FL, 2121620700, 0xFCBDA653L, 0x8E902444L, 0xCA742E12L, 0xB8424071L, 0xB4B15EC2L, 0x943BFA09L, 0xBC97CD93L, 1285603712, 798920280, 0x8B58328FL, 0xF9822360L, 0xD1FD15EEL, 1077514121, 1436444106, 0xA2D6C17EL, 1507202797, 500756149, 198754565, 0x8E014807L, 880454148, 1970517398, 0xBFC6EE25L, 1161840191, 560498076, 1782600856, 0x9D93FEBEL, 1285196205, 788797746, 1195724574, 0xF2174A07L, 103427523, 0x952BFE83L, 0xF730AC4CL, 617564657, 978211984, 1781482121, 0x8379D23AL, 0xEAD737EEL, 0xE41555FBL, 659557668, 0x99F3B244L, 1561884856, 0x842C31A4L, 1189296962, 169145316, 0xA5CE044CL, 1323893433, 824667876, 408202876, 0xE0178482L, 0xF412BBBCL, 1508996065, 162419237, 0xDE740B00L, 0xB7CB64FDL, 0xEBCADB1FL, 0x8EAE2326L, 0x933C216CL, 0xD7D1F649L, 481927014, 0xA448AC16L, 0xBC082807L, 1261069441, 2063238535, 0x8474A61DL, 101459755, 0xBC5654D1L, 1721190841, 1078395785, 176506553, 0xD3C5280FL, 1566142515, 1938949000, 1499289517, 0xC59872F8L, 829714860, 0xE51502A2L, 952932374, 1283577465, 2045007203, 0xEBE6A798L, 0xE09575CDL, 0xADDF4157L, 0xC4770191L, 482297421, 1734231412, 0xDAC71054L, 0x99807E43L, 0xA88D74B1L, 0xCB77E028L, 1533519803, 0xEEEBC3B6L, 0xE7E680E5L, 272960248, 317508587, 0xC4B10CDCL, 0x91776399L, 27470488, 1666674386, 1737927609, 750987808, 0x8E364D8FL, 0xA0985A77L, 562925334, 0x837D6DC3L)</span><br><span class="line">        76      LIST_EXTEND             1</span><br><span class="line">        78      STORE_NAME              12: ᘙ</span><br><span class="line">        80      LOAD_CONST              0: 0</span><br><span class="line">        82      STORE_NAME              13: i</span><br><span class="line">        84      LOAD_NAME               13: i</span><br><span class="line">        86      LOAD_NAME               14: len      while i&lt;len(c):</span><br><span class="line">        88      LOAD_NAME               10: c</span><br><span class="line">        90      CALL_FUNCTION           1</span><br><span class="line">        92      COMPARE_OP              0 (&lt;)</span><br><span class="line">        94      POP_JUMP_IF_FALSE       84 (to 168) // 当不成立的时候就错误的跳转</span><br><span class="line">        96      LOAD_CONST              0: 0</span><br><span class="line">        98      STORE_NAME              15: index   index = 0</span><br><span class="line">        100     LOAD_NAME               10: c</span><br><span class="line">        102     LOAD_NAME               13: i</span><br><span class="line">        104     LOAD_NAME               13: i</span><br><span class="line">        106     LOAD_CONST              9: 4</span><br><span class="line">        108     BINARY_ADD                   // i+4</span><br><span class="line">        110     BUILD_SLICE             2    c[i:i+4]</span><br><span class="line">        112     BINARY_SUBSCR               // 读取其中的值    </span><br><span class="line">        114     GET_ITER                    // 开始迭代</span><br><span class="line">        116     FOR_ITER                10 (to 138)</span><br><span class="line">        118     STORE_NAME              16: ii</span><br><span class="line">        120     LOAD_NAME               15: index</span><br><span class="line">        122     LOAD_CONST              10: 8</span><br><span class="line">        124     BINARY_LSHIFT           // index&lt;&lt;8</span><br><span class="line">        126     LOAD_NAME               17: ord</span><br><span class="line">        128     LOAD_NAME               16: ii</span><br><span class="line">        130     CALL_FUNCTION           1</span><br><span class="line">        132     BINARY_ADD              (index&lt;&lt;8)+ord(ii)</span><br><span class="line">        134     STORE_NAME              15: index   index =  (index&lt;&lt;8)+ord(ii)</span><br><span class="line">        136     JUMP_ABSOLUTE           58</span><br><span class="line">        138     LOAD_NAME               11: store</span><br><span class="line">        140     LOAD_METHOD             18: append</span><br><span class="line">        142     LOAD_NAME               15: index   </span><br><span class="line">        144     CALL_METHOD             1    store.append(index)</span><br><span class="line">        146     POP_TOP                 </span><br><span class="line">        148     LOAD_NAME               13: i</span><br><span class="line">        150     LOAD_CONST              9: 4</span><br><span class="line">        152     INPLACE_ADD               // i = i+4</span><br><span class="line">        154     STORE_NAME              13: i</span><br><span class="line">        156     LOAD_NAME               13: i</span><br><span class="line">        158     LOAD_NAME               14: len</span><br><span class="line">        160     LOAD_NAME               10: c</span><br><span class="line">        162     CALL_FUNCTION           1</span><br><span class="line">        164     COMPARE_OP              0 (&lt;)  i&lt;len(c)</span><br><span class="line">        166     POP_JUMP_IF_TRUE        48 (to 96)     if not i&lt;len(c):</span><br><span class="line">        168     BUILD_LIST              0</span><br><span class="line">        170     LOAD_CONST              11: (54, 54, 54, 54)</span><br><span class="line">        172     LIST_EXTEND             1</span><br><span class="line">        174     STORE_NAME              19: ᘝ</span><br><span class="line">        176     LOAD_NAME               14: len</span><br><span class="line">        178     LOAD_NAME               11: store</span><br><span class="line">        180     CALL_FUNCTION           1</span><br><span class="line">        182     STORE_NAME              20: ᘠ</span><br><span class="line">        184     LOAD_NAME               21: encrypt</span><br><span class="line">        186     LOAD_NAME               20: ᘠ</span><br><span class="line">        188     LOAD_NAME               11: store</span><br><span class="line">        190     LOAD_NAME               19: ᘝ</span><br><span class="line">        192     CALL_FUNCTION           3</span><br><span class="line">        194     STORE_NAME              22: res</span><br><span class="line">        196     LOAD_NAME               11: store</span><br><span class="line">        198     LOAD_NAME               12: ᘙ</span><br><span class="line">        200     COMPARE_OP              2 (==)</span><br><span class="line">        202     POP_JUMP_IF_FALSE       114 (to 228)</span><br><span class="line">        204     LOAD_NAME               23: print</span><br><span class="line">        206     LOAD_CONST              12: 'You are right!'</span><br><span class="line">        208     CALL_FUNCTION           1</span><br><span class="line">        210     POP_TOP                 </span><br><span class="line">        212     LOAD_NAME               2: input</span><br><span class="line">        214     LOAD_CONST              13: ''</span><br><span class="line">        216     CALL_FUNCTION           1</span><br><span class="line">        218     POP_TOP                 </span><br><span class="line">        220     LOAD_NAME               24: quit</span><br><span class="line">        222     CALL_FUNCTION           0</span><br><span class="line">        224     POP_TOP                 </span><br><span class="line">        226     JUMP_FORWARD            4 (to 236)</span><br><span class="line">        228     LOAD_NAME               23: print</span><br><span class="line">        230     LOAD_CONST              14: 'Why not drink a cup of tea and have a rest?'</span><br><span class="line">        232     CALL_FUNCTION           1</span><br><span class="line">        234     POP_TOP                 </span><br><span class="line">        236     JUMP_ABSOLUTE           9</span><br><span class="line">        238     LOAD_CONST              15: None</span><br><span class="line">        240     RETURN_VALUE            </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="pyz文件解密"><a href="#pyz文件解密" class="headerlink" title="pyz文件解密"></a>pyz文件解密</h3><p>送上面修复的反编译的结果之中我们能够看到，这里引用了一个函数，这个函数是重cup这个包中导入的</p>
<p>这个包的获得是在PYZ-00.pyz_extracted文件夹：</p>
<blockquote>
<p>一般一个稍微大一点的项目都会分成多个py文件，甚至会依赖其他模块，这些被依赖的文件解析后都会放入PYZ-00.pyz_extracted文件夹之中，这个文件之中相当于放的是核心代码，这个文件之中放入的就是PYZ-00.pyz这个文件解压之后得到的文件，注意这个文件想要用pyinstxtractor.py正常得到，我们需要在这个pyc相对应的python环境之中运行该脚本（上面已经介绍了怎么管理多个python环境）</p>
</blockquote>
<p>这里的pyz文件进行了加密，因为pyinstaller可以将文件pyc进行一定的压缩加密，以防止被逆向</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-271253.htm">pyz文件加密解密</a></p>
<h4 id="pyz文件加密的密钥和过程的文件"><a href="#pyz文件加密的密钥和过程的文件" class="headerlink" title="pyz文件加密的密钥和过程的文件"></a>pyz文件加密的密钥和过程的文件</h4><p>通过pyinstxtractor获得了部分没有加密的pyc文件，其中就有archive.pyc文件（得到加密过程）和crypto_key文件(得到具体key参数)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220504152929032.png" alt="image-20220504152929032"></p>
<p>archive.pyc文件:(反编译)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220504153248511.png" alt="image-20220504153248511"></p>
<p>加密的关键代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220504153401888.png" alt="image-20220504153401888"></p>
<p>crypto_key文件:(反编译)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key = '0000000000000tea'</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220504153121767.png" alt="image-20220504153121767"></p>
<p>因为在源加密代码之中加密函数是从cup这个包之中引入的，所以我们在那个解压缩之后得到的文件夹之中找到对应的对应的包的加密文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF2022-FATE/image-20220504154026910.png" alt="image-20220504154026910"></p>
<h4 id="pyz文件解密脚本"><a href="#pyz文件解密脚本" class="headerlink" title="pyz文件解密脚本"></a>pyz文件解密脚本</h4><p><a target="_blank" rel="noopener" href="https://github.com/extremecoders-re/pyinstxtractor/wiki/Frequently-Asked-Questions">解密</a>该文件：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import tinyaes</span><br><span class="line">import zlib</span><br><span class="line"></span><br><span class="line">CRYPT_BLOCK_SIZE = 16</span><br><span class="line"></span><br><span class="line"># key obtained from pyimod00_crypto_key</span><br><span class="line">key = bytes('0000000000000tea', 'utf-8')</span><br><span class="line"></span><br><span class="line">inf = open('cup.pyc.encrypted', 'rb') # encrypted file input</span><br><span class="line">outf = open('cup.pyc', 'wb') # output file</span><br><span class="line"></span><br><span class="line"># Initialization vector</span><br><span class="line">iv = inf.read(CRYPT_BLOCK_SIZE)</span><br><span class="line"></span><br><span class="line">cipher = tinyaes.AES(key, iv)</span><br><span class="line"></span><br><span class="line"># Decrypt and decompress</span><br><span class="line">plaintext = zlib.decompress(cipher.CTR_xcrypt_buffer(inf.read()))</span><br><span class="line"></span><br><span class="line"># Write pyc header</span><br><span class="line"># The header below is for Python 3.8</span><br><span class="line">outf.write(b'\x6f\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0')</span><br><span class="line"></span><br><span class="line"># Write decrypted data</span><br><span class="line">outf.write(plaintext)</span><br><span class="line"></span><br><span class="line">inf.close()</span><br><span class="line">outf.close()</span><br></pre></td></tr></tbody></table></figure>

<p>各个python版本打包的pyc文件的文件头：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7: \x03\xf3\x0d\x0a\0\0\0\0</span><br><span class="line">Python 3.0: \x3b\x0c\x0d\x0a\0\0\0\0</span><br><span class="line">Python 3.1: \x4f\x0c\x0d\x0a\0\0\0\0</span><br><span class="line">Python 3.2: \x6c\x0c\x0d\x0a\0\0\0\0</span><br><span class="line">Python 3.3: \x9e\x0c\x0d\x0a\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.4: \xee\x0c\x0d\x0a\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.5: \x17\x0d\x0d\x0a\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.6: \x33\x0d\x0d\x0a\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.7: \x42\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.8: \x55\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.9: \x61\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0</span><br><span class="line">Python 3.10: \x6f\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0</span><br></pre></td></tr></tbody></table></figure>

<h3 id="xxtea解密"><a href="#xxtea解密" class="headerlink" title="xxtea解密"></a>xxtea解密</h3><p>得到的加密函数encrypt()的pyc文件，所以对这个文件反编译就能够知道函数逻辑</p>
<p>可以看到这里加密的方法是xxtea，这里反编译得到的代码还是有点问题，但是我们可以明显的知道这个地方用的都是xxtea加密</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># visit https://tool.lu/pyc/ for more information</span><br><span class="line"># Version: Python 3.10</span><br><span class="line"></span><br><span class="line">import libnum</span><br><span class="line">from ctypes import *</span><br><span class="line"></span><br><span class="line">def MX(z, y, total, key, p, e):</span><br><span class="line">    temp1 = (z.value &gt;&gt; 5 ^ y.value &lt;&lt; 2) + (y.value &gt;&gt; 3 ^ z.value &lt;&lt; 4)</span><br><span class="line">    temp2 = (total.value ^ y.value) + (key[p &amp; 3 ^ e.value] ^ z.value)</span><br><span class="line">    return c_uint32(temp1 ^ temp2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def encrypt(n, v, key):</span><br><span class="line">    DELTA = 0x9E3779B9L</span><br><span class="line">    rounds = 6 + 52 // n</span><br><span class="line">    total = c_uint32(0)</span><br><span class="line">    z = c_uint32(v[n - 1])</span><br><span class="line">    e = c_uint32(0)</span><br><span class="line">    while rounds &gt; 0:</span><br><span class="line">        total.value += DELTA</span><br><span class="line">        e.value = total.value &gt;&gt; 2 &amp; 3</span><br><span class="line">        y = c_uint32(v[0])</span><br><span class="line">        v[n - 1] = c_uint32(v[n - 1] + MX(z, y, total, key, n - 1, e).value).value</span><br><span class="line">        z.value = v[n - 1]</span><br><span class="line">        rounds -= 1</span><br><span class="line">        if not rounds &gt; 0:</span><br><span class="line">            return v</span><br></pre></td></tr></tbody></table></figure>

<p>所以xxtea解密：</p>
<p>因为加密的数据是按照大序端存放的，并且给得到的是经过rsa加密的数字的字符串</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9E3779B9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    {</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        {</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++)</span><br><span class="line">            {</span><br><span class="line">                y = v[p+<span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            }</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    {</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = rounds*DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        {</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">            {</span><br><span class="line">                z = v[p<span class="number">-1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            }</span><br><span class="line">            z = v[n<span class="number">-1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">uint32_t</span> v[]= {<span class="number">0xd28ed952</span>,<span class="number">0x57c844df</span>,<span class="number">0xd91ba938</span>,<span class="number">0xf9f3bd2d</span>,<span class="number">0x8ef8e43d</span>,<span class="number">0x24d0a6d4</span>,<span class="number">0x57e35037</span>,<span class="number">0x57b9a2ea</span>,<span class="number">0x3c5f16c0</span>,<span class="number">0xd7821910</span>,<span class="number">0x3b3d098c</span>,<span class="number">0x1a22518d</span>,<span class="number">0xc83555b7</span>,<span class="number">0xe8dff468</span>,<span class="number">0xbdbdffd</span>,<span class="number">0xc5b84feb</span>,<span class="number">0xd9f837c6</span>,<span class="number">0x248c0bef</span>,<span class="number">0x8efa4edd</span>,<span class="number">0x5cc7851</span>,<span class="number">0x8b4b608c</span>,<span class="number">0x57b785f2</span>,<span class="number">0xc0b62792</span>,<span class="number">0x22c8fc3e</span>,<span class="number">0xaab1c22d</span>,<span class="number">0xbdb9c266</span>,<span class="number">0x528335db</span>,<span class="number">0xae9f9816</span>,<span class="number">0xd1f40b3c</span>,<span class="number">0x8206ddc3</span>,<span class="number">0xc4e0badc</span>,<span class="number">0xe407bd26</span>,<span class="number">0x8ae5685</span>,<span class="number">0x8016c6a5</span>,<span class="number">0xaf4ab9d3</span>,<span class="number">0x1e35204a</span>,<span class="number">0x3b483e49</span>,<span class="number">0x85082a0b</span>,<span class="number">0xca0bc95a</span>,<span class="number">0xa7be567c</span>,<span class="number">0x41eb42c8</span>,<span class="number">0x6aad143c</span>,<span class="number">0xdfefb591</span>,<span class="number">0x93346b38</span>,<span class="number">0x4547158e</span>,<span class="number">0x289465d1</span>,<span class="number">0xaee1a7a2</span>,<span class="number">0x80e574ae</span>,<span class="number">0xf154f55f</span>,<span class="number">0x7e755cdc</span>,<span class="number">0xfcbda653</span>,<span class="number">0x8e902444</span>,<span class="number">0xca742e12</span>,<span class="number">0xb8424071</span>,<span class="number">0xb4b15ec2</span>,<span class="number">0x943bfa09</span>,<span class="number">0xbc97cd93</span>,<span class="number">0x4ca0c180</span>,<span class="number">0x2f9e8e58</span>,<span class="number">0x8b58328f</span>,<span class="number">0xf9822360</span>,<span class="number">0xd1fd15ee</span>,<span class="number">0x40398f89</span>,<span class="number">0x559e65ca</span>,<span class="number">0xa2d6c17e</span>,<span class="number">0x59d616ed</span>,<span class="number">0x1dd8eeb5</span>,<span class="number">0xbd8c105</span>,<span class="number">0x8e014807</span>,<span class="number">0x347aaa04</span>,<span class="number">0x7573b596</span>,<span class="number">0xbfc6ee25</span>,<span class="number">0x4540463f</span>,<span class="number">0x2168859c</span>,<span class="number">0x6a405498</span>,<span class="number">0x9d93febe</span>,<span class="number">0x4c9a89ad</span>,<span class="number">0x2f041932</span>,<span class="number">0x47454f1e</span>,<span class="number">0xf2174a07</span>,<span class="number">0x62a2dc3</span>,<span class="number">0x952bfe83</span>,<span class="number">0xf730ac4c</span>,<span class="number">0x24cf49f1</span>,<span class="number">0x3a4e5490</span>,<span class="number">0x6a2f4289</span>,<span class="number">0x8379d23a</span>,<span class="number">0xead737ee</span>,<span class="number">0xe41555fb</span>,<span class="number">0x27500d24</span>,<span class="number">0x99f3b244</span>,<span class="number">0x5d1878b8</span>,<span class="number">0x842c31a4</span>,<span class="number">0x46e33b42</span>,<span class="number">0xa14f3e4</span>,<span class="number">0xa5ce044c</span>,<span class="number">0x4ee902b9</span>,<span class="number">0x31276ee4</span>,<span class="number">0x1854ae7c</span>,<span class="number">0xe0178482</span>,<span class="number">0xf412bbbc</span>,<span class="number">0x59f173e1</span>,<span class="number">0x9ae5225</span>,<span class="number">0xde740b00</span>,<span class="number">0xb7cb64fd</span>,<span class="number">0xebcadb1f</span>,<span class="number">0x8eae2326</span>,<span class="number">0x933c216c</span>,<span class="number">0xd7d1f649</span>,<span class="number">0x1cb99f66</span>,<span class="number">0xa448ac16</span>,<span class="number">0xbc082807</span>,<span class="number">0x4b2a6481</span>,<span class="number">0x7afa8587</span>,<span class="number">0x8474a61d</span>,<span class="number">0x60c272b</span>,<span class="number">0xbc5654d1</span>,<span class="number">0x669749b9</span>,<span class="number">0x40470389</span>,<span class="number">0xa8546b9</span>,<span class="number">0xd3c5280f</span>,<span class="number">0x5d597033</span>,<span class="number">0x73920388</span>,<span class="number">0x595d57ad</span>,<span class="number">0xc59872f8</span>,<span class="number">0x317471ac</span>,<span class="number">0xe51502a2</span>,<span class="number">0x38cc9816</span>,<span class="number">0x4c81d679</span>,<span class="number">0x79e45563</span>,<span class="number">0xebe6a798</span>,<span class="number">0xe09575cd</span>,<span class="number">0xaddf4157</span>,<span class="number">0xc4770191</span>,<span class="number">0x1cbf464d</span>,<span class="number">0x675e4574</span>,<span class="number">0xdac71054</span>,<span class="number">0x99807e43</span>,<span class="number">0xa88d74b1</span>,<span class="number">0xcb77e028</span>,<span class="number">0x5b67a7bb</span>,<span class="number">0xeeebc3b6</span>,<span class="number">0xe7e680e5</span>,<span class="number">0x10450af8</span>,<span class="number">0x12eccbeb</span>,<span class="number">0xc4b10cdc</span>,<span class="number">0x91776399</span>,<span class="number">0x1a32a98</span>,<span class="number">0x63576ed2</span>,<span class="number">0x6796abb9</span>,<span class="number">0x2cc32a20</span>,<span class="number">0x8e364d8f</span>,<span class="number">0xa0985a77</span>,<span class="number">0x218d8f16</span>,<span class="number">0x837d6dc3</span>,<span class="number">0x0</span>};</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]= {<span class="number">54</span>,<span class="number">54</span>,<span class="number">54</span>,<span class="number">54</span>};</span><br><span class="line">    <span class="type">int</span> n= <span class="number">155</span>; <span class="comment">//n的绝对值表示v的长度，取正表示加密，取负表示解密</span></span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line"><span class="comment">//    printf("加密前原始数据：%s\n",(char*)v);</span></span><br><span class="line"><span class="comment">//    btea(v, n, k);</span></span><br><span class="line"><span class="comment">//    printf("加密后的数据：%u %u %u\n",v[0],v[1],v[3]);</span></span><br><span class="line">    btea(v, -n, k);</span><br><span class="line"><span class="comment">//    printf("解密后的数据：%s\n",(char*)v);</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">155</span>;i++)</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%c"</span>,((v[i]&gt;&gt;<span class="number">24</span>)&amp;<span class="number">0xff</span>));</span><br><span class="line">        v[i] = v[i]&lt;&lt;<span class="number">8</span>; <span class="comment">// 将这个数左移8位</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>xxtea解密结果：（RSA的密文）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10610336534759505889607399322387179316771488492347274741918862678692508953185876570981227584004676580623553664818853686933004290078153620168054665086468417541382824708104480882577200529822968531743002301934310349005341104696887943182074473298650903541494918266823037984054778903666406545980557074219162536057146090758158128189406073809226361445046225524917089434897957301396534515964547462425719205819342172669899546965221084098690893672595962129879041507903210851706793788311452973769358455761907303633956322972510500253009083922781934406731633755418753858930476576720874219359466503538931371444470303193503733920039</span><br></pre></td></tr></tbody></table></figure>

<h3 id="RSA低解密指数攻击"><a href="#RSA低解密指数攻击" class="headerlink" title="RSA低解密指数攻击"></a>RSA低解密指数攻击</h3><p>RSA解密，在题目之中提供了n和公钥 </p>
<p>素数分解的网站 <a target="_blank" rel="noopener" href="http://www.factordb.com/index.php%EF%BC%88%E8%BF%99%E9%81%93%E9%A2%98%E7%94%A8%E4%B8%8D%E4%B8%8A%EF%BC%89">http://www.factordb.com/index.php（这道题用不上）</a></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e = 0x647327833ACFEF1F9C83E74E171FC300FA347D4A6769476C33DA82C95120ACB38B62B33D429206FE6E9BB0BB7AB748A1036971BEA36EC47130B749C1C9FF6FE03D0F7D9FC5346EB0E575BDFA6C530AA57CD676894FC080D2DD049AB59625F4B9C78BCFD95CDCD2793E440E26E189D251121CB6EB177FEDB596409034E8B0C5BBD9BD9342235DBB226C9170EFE347FF0FD2CFF9A1F7B647CC83E4D8F005FD7125A89251C768AFE70BDD54B88116814D5030F499BCAC4673CCCC342FB4B6AC58EA5A64546DC25912B6C430529F6A7F449FD96536DE269D1A1B015A4AC6B6E46EE19DCE8143726A6503E290E4BAE6BD78319B5878981F6CFFDB3B818209341FD68B</span><br><span class="line">n = </span><br><span class="line">0x649EE967E7916A825CC9FD3320BEABF263BEAC68C080F52824A0F521EDB6B78577EC52BF1C9E78F4BB71192F9A23F1A17AA76E5979E4D953329D3CA65FB4A71DA57412B59DFD6AEDF0191C5555D3E5F582B81B5E6B23163E9889204A81AFFDF119FE25C92F4ED59BD3285BCD7AAE14824240D2E33C5A97848F4EB7AAC203DE6330D2B4D8FF61691544FBECD120F99A157B3D2F58FA51B2887A9D06CA383C44D071314A12B17928B96F03A06E959A5AFEFA0183664F52CD32B9FC72A04B45913FCB2D5D2D3A415A14F611CF1EAC2D6C785142A8E9CC41B67A6CD85001B06EDB8CA767D367E56E0AE651491BF8A8C17A38A1835DB9E4A9292B1D86D5776C98CC25</span><br></pre></td></tr></tbody></table></figure>

<p>这里的RSA是低解密指数攻击</p>
<blockquote>
<p>在RSA中d也称为解密指数，当d比较小的时候，e也就显得特别大了。<br>适用情况：e过大或过小（一般e过大时使用）</p>
<p>使用工具：工具rsa-wiener-attack</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Mr-Aur0ra/RSA/blob/master/PKCS1_OAEP%E6%A8%A1%E5%BC%8F%E7%9A%84RSA/%E5%9F%BA%E4%BA%8Ersa-wiener-attack%E8%A7%A3%E9%A2%98/%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF.md">使用工具rsa-wiener-attack解密</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/pablocelayes/rsa-wiener-attack">rsa-wiener-attack下载地址</a></p>
<p>利用这个工具是为了得到d，然后再使用RSA解密运算 pow(c,d,n) 得到最终的密文</p>
<p>RSA解密脚本：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.PublicKey import RSA</span><br><span class="line">import ContinuedFractions, Arithmetic</span><br><span class="line">from Crypto.Util.number import long_to_bytes</span><br><span class="line"></span><br><span class="line">def wiener_hack(e, n):</span><br><span class="line">    # firstly git clone https://github.com/pablocelayes/rsa-wiener-attack.git !</span><br><span class="line">    frac = ContinuedFractions.rational_to_contfrac(e, n)</span><br><span class="line">    convergents = ContinuedFractions.convergents_from_contfrac(frac)</span><br><span class="line">    for (k, d) in convergents:</span><br><span class="line">        if k != 0 and (e * d - 1) % k == 0:</span><br><span class="line">            phi = (e * d - 1) // k</span><br><span class="line">            s = n - phi + 1</span><br><span class="line">            discr = s * s - 4 * n</span><br><span class="line">            if (discr &gt;= 0):</span><br><span class="line">                t = Arithmetic.is_perfect_square(discr)</span><br><span class="line">                if t != -1 and (s + t) % 2 == 0:</span><br><span class="line">                    print("First: Hacked d.")</span><br><span class="line">                    return d</span><br><span class="line">    return False</span><br><span class="line">n = 0x649EE967E7916A825CC9FD3320BEABF263BEAC68C080F52824A0F521EDB6B78577EC52BF1C9E78F4BB71192F9A23F1A17AA76E5979E4D953329D3CA65FB4A71DA57412B59DFD6AEDF0191C5555D3E5F582B81B5E6B23163E9889204A81AFFDF119FE25C92F4ED59BD3285BCD7AAE14824240D2E33C5A97848F4EB7AAC203DE6330D2B4D8FF61691544FBECD120F99A157B3D2F58FA51B2887A9D06CA383C44D071314A12B17928B96F03A06E959A5AFEFA0183664F52CD32B9FC72A04B45913FCB2D5D2D3A415A14F611CF1EAC2D6C785142A8E9CC41B67A6CD85001B06EDB8CA767D367E56E0AE651491BF8A8C17A38A1835DB9E4A9292B1D86D5776C98CC25</span><br><span class="line">e = 0x647327833ACFEF1F9C83E74E171FC300FA347D4A6769476C33DA82C95120ACB38B62B33D429206FE6E9BB0BB7AB748A1036971BEA36EC47130B749C1C9FF6FE03D0F7D9FC5346EB0E575BDFA6C530AA57CD676894FC080D2DD049AB59625F4B9C78BCFD95CDCD2793E440E26E189D251121CB6EB177FEDB596409034E8B0C5BBD9BD9342235DBB226C9170EFE347FF0FD2CFF9A1F7B647CC83E4D8F005FD7125A89251C768AFE70BDD54B88116814D5030F499BCAC4673CCCC342FB4B6AC58EA5A64546DC25912B6C430529F6A7F449FD96536DE269D1A1B015A4AC6B6E46EE19DCE8143726A6503E290E4BAE6BD78319B5878981F6CFFDB3B818209341FD68B</span><br><span class="line">c = 10610336534759505889607399322387179316771488492347274741918862678692508953185876570981227584004676580623553664818853686933004290078153620168054665086468417541382824708104480882577200529822968531743002301934310349005341104696887943182074473298650903541494918266823037984054778903666406545980557074219162536057146090758158128189406073809226361445046225524917089434897957301396534515964547462425719205819342172669899546965221084098690893672595962129879041507903210851706793788311452973769358455761907303633956322972510500253009083922781934406731633755418753858930476576720874219359466503538931371444470303193503733920039</span><br><span class="line"></span><br><span class="line">d = wiener_hack(e, n)</span><br><span class="line">m = pow(c,d,n)</span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line">b'flag{You_Need_Some_Tea}'</span><br></pre></td></tr></tbody></table></figure>

<p>所以最后的flag是  flag{You_Need_Some_Tea} </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Gruge</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/05/04/DASCTF2022-FATE/">http://example.com/2022/05/04/DASCTF2022-FATE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Gruge's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/md5/">md5</a><a class="post-meta__tags" href="/tags/SHA1/">SHA1</a><a class="post-meta__tags" href="/tags/Wincrpt%E8%A7%A3%E5%AF%86AES/">Wincrpt解密AES</a><a class="post-meta__tags" href="/tags/APK%E5%8A%A0%E5%9B%BA/">APK加固</a><a class="post-meta__tags" href="/tags/APK%E8%84%B1%E5%A3%B3-blackdex/">APK脱壳(blackdex)</a><a class="post-meta__tags" href="/tags/pyc%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8C%85-pyinstxtractor/">pyc文件解包(pyinstxtractor)</a><a class="post-meta__tags" href="/tags/pyz%E6%96%87%E4%BB%B6%E8%A7%A3%E5%AF%86/">pyz文件解密</a><a class="post-meta__tags" href="/tags/pyc%E6%96%87%E4%BB%B6%E5%8F%8D%E7%BC%96%E8%AF%91-pycdc%E5%B7%A5%E5%85%B7/">pyc文件反编译(pycdc工具)</a><a class="post-meta__tags" href="/tags/RSA%E4%BD%8E%E8%A7%A3%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB/">RSA低解密指数攻击</a></div><div class="post_share"><div class="social-share" data-image="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/04/25/starCTF2022-Simple-NaCl/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">starCTF2022_Simple+NaCl</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/463b631c6a0f63ec.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">Gruge</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CrackMe"><span class="toc-number">1.</span> <span class="toc-text">CrackMe</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">定位关键函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0%E9%80%BB%E8%BE%91"><span class="toc-number">1.2.</span> <span class="toc-text">分析关键函数逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E4%B8%AA%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">4个加密函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E5%8A%A0%E5%AF%86%E7%BB%93%E6%9E%9C%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%88OD%EF%BC%89"><span class="toc-number">1.2.2.</span> <span class="toc-text">提取加密结果的数据（OD）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5%E8%A7%A3%E5%AF%86"><span class="toc-number">1.3.</span> <span class="toc-text">md5解密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SHA1%E8%A7%A3%E5%AF%86"><span class="toc-number">1.4.</span> <span class="toc-text">SHA1解密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Wincrpt%E8%A7%A3%E5%AF%86AES"><span class="toc-number">1.5.</span> <span class="toc-text">Wincrpt解密AES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Wincrpt"><span class="toc-number">1.5.1.</span> <span class="toc-text">Wincrpt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CryptDecrypt%E7%9A%84%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.5.2.</span> <span class="toc-text">CryptDecrypt的讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CryptDecrypt%E7%9A%84%E8%AE%B2%E8%A7%A3-1"><span class="toc-number">1.5.3.</span> <span class="toc-text">CryptDecrypt的讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">1.5.4.</span> <span class="toc-text">解密脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fakePica"><span class="toc-number">2.</span> <span class="toc-text">fakePica</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90APK%E5%8A%A0%E5%9B%BA%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">分析APK加固的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blackdex-APK%E8%84%B1%E5%A3%B3"><span class="toc-number">2.2.</span> <span class="toc-text">blackdex-APK脱壳</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A4%E6%96%AD32%E4%BD%8D%E8%BF%98%E6%98%AF64%E4%BD%8D%E7%9A%84APK%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.1.</span> <span class="toc-text">判断32位还是64位的APK文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%84%B1%E5%A3%B3%E5%BE%97%E5%88%B0%E7%9A%84dex%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">分析脱壳得到的dex文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AES%E8%A7%A3%E5%AF%86"><span class="toc-number">2.3.1.</span> <span class="toc-text">AES解密</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%87%E6%80%AA%E7%9A%84%E4%BA%A4%E6%98%93"><span class="toc-number">3.</span> <span class="toc-text">奇怪的交易</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pyc%E6%96%87%E4%BB%B6%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%B8%AD%E7%9A%84pyz%E6%96%87%E4%BB%B6%E8%A7%A3%E5%8C%85"><span class="toc-number">3.1.</span> <span class="toc-text">pyc文件以及其中的pyz文件解包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pyz%E6%96%87%E4%BB%B6%E8%A7%A3%E5%AF%86"><span class="toc-number">3.2.</span> <span class="toc-text">pyz文件解密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pyz%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AF%86%E9%92%A5%E5%92%8C%E8%BF%87%E7%A8%8B%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">pyz文件加密的密钥和过程的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pyz%E6%96%87%E4%BB%B6%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">3.2.2.</span> <span class="toc-text">pyz文件解密脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xxtea%E8%A7%A3%E5%AF%86"><span class="toc-number">3.3.</span> <span class="toc-text">xxtea解密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RSA%E4%BD%8E%E8%A7%A3%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB"><span class="toc-number">3.4.</span> <span class="toc-text">RSA低解密指数攻击</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/04/DASCTF2022-FATE/" title="DASCTF2022-FATE"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DASCTF2022-FATE"></a><div class="content"><a class="title" href="/2022/05/04/DASCTF2022-FATE/" title="DASCTF2022-FATE">DASCTF2022-FATE</a><time datetime="2022-05-04T09:44:12.000Z" title="发表于 2022-05-04 17:44:12">2022-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/25/starCTF2022-Simple-NaCl/" title="starCTF2022_Simple+NaCl"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="starCTF2022_Simple+NaCl"></a><div class="content"><a class="title" href="/2022/04/25/starCTF2022-Simple-NaCl/" title="starCTF2022_Simple+NaCl">starCTF2022_Simple+NaCl</a><time datetime="2022-04-25T12:10:56.000Z" title="发表于 2022-04-25 20:10:56">2022-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/21/DASCTF-Login/" title="DASCTF_Login"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DASCTF_Login"></a><div class="content"><a class="title" href="/2022/04/21/DASCTF-Login/" title="DASCTF_Login">DASCTF_Login</a><time datetime="2022-04-21T06:04:38.000Z" title="发表于 2022-04-21 14:04:38">2022-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/15/HFCTF2022-theShellcode/" title="HFCTF2022_theShellcode"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HFCTF2022_theShellcode"></a><div class="content"><a class="title" href="/2022/04/15/HFCTF2022-theShellcode/" title="HFCTF2022_theShellcode">HFCTF2022_theShellcode</a><time datetime="2022-04-15T14:35:25.000Z" title="发表于 2022-04-15 22:35:25">2022-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/13/starCTF/" title="starCTF2021"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="starCTF2021"></a><div class="content"><a class="title" href="/2022/04/13/starCTF/" title="starCTF2021">starCTF2021</a><time datetime="2022-04-13T01:20:26.000Z" title="发表于 2022-04-13 09:20:26">2022-04-13</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2022 By Gruge</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '1aa3bac2fd8cfac9d7c3',
      clientSecret: '7640d6d45e9030f665c75a640991b67e8367e67d',
      repo: 'G2uge.github.io',
      owner: 'G2uge',
      admin: ['G2uge'],
      id: 'c5e146010de482c3faf7f26c0b237fb6',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>