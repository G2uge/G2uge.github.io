<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>DASCTF_Oct | Gruge's Blog</title><meta name="keywords" content="base91解密,SM4解密"><meta name="author" content="Gruge"><meta name="copyright" content="Gruge"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="DASCTF_Oct_re这两道题中都有加密的知识点，第一道题的SM4的解密在最后一步仍然有问题，希望大佬能够指点指点(●’◡’●) 马猴烧酒知识点：   魔改SM4 魔改base64   用ida6将文件载入其中  定位到相应的代码的位置，这段代码开始的位置就有一段flag{this_is_fake_flag}的flag  密钥的生成第一个函数是获取时间戳，第二个函数是对时间戳base64的变表">
<meta property="og:type" content="article">
<meta property="og:title" content="DASCTF_Oct">
<meta property="og:url" content="http://example.com/2022/03/20/DASCTF-Oct/index.html">
<meta property="og:site_name" content="Gruge's Blog">
<meta property="og:description" content="DASCTF_Oct_re这两道题中都有加密的知识点，第一道题的SM4的解密在最后一步仍然有问题，希望大佬能够指点指点(●’◡’●) 马猴烧酒知识点：   魔改SM4 魔改base64   用ida6将文件载入其中  定位到相应的代码的位置，这段代码开始的位置就有一段flag{this_is_fake_flag}的flag  密钥的生成第一个函数是获取时间戳，第二个函数是对时间戳base64的变表">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg">
<meta property="article:published_time" content="2022-03-20T01:53:18.000Z">
<meta property="article:modified_time" content="2022-03-20T02:00:57.357Z">
<meta property="article:author" content="Gruge">
<meta property="article:tag" content="base91解密">
<meta property="article:tag" content="SM4解密">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/03/20/DASCTF-Oct/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DASCTF_Oct',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-20 10:00:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/modify.css"><meta name="generator" content="Hexo 5.4.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/463b631c6a0f63ec.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Gruge's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DASCTF_Oct</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-20T01:53:18.000Z" title="发表于 2022-03-20 09:53:18">2022-03-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-20T02:00:57.357Z" title="更新于 2022-03-20 10:00:57">2022-03-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%8D%E7%8E%B0/">复现</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="DASCTF_Oct"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg');"></div><article class="post-content" id="article-container"><h1 id="DASCTF-Oct-re"><a href="#DASCTF-Oct-re" class="headerlink" title="DASCTF_Oct_re"></a>DASCTF_Oct_re</h1><p>这两道题中都有加密的知识点，第一道题的SM4的解密在最后一步仍然有问题，希望大佬能够指点指点(●’◡’●)</p>
<h2 id="马猴烧酒"><a href="#马猴烧酒" class="headerlink" title="马猴烧酒"></a>马猴烧酒</h2><p><strong>知识点</strong>：</p>
<blockquote>
<ol>
<li>魔改SM4</li>
<li>魔改base64</li>
</ol>
</blockquote>
<p>用ida6将文件载入其中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220318181826345.png" alt="image-20220318181826345"></p>
<p>定位到相应的代码的位置，这段代码开始的位置就有一段flag{this_is_fake_flag}的flag</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220318182418204.png" alt="image-20220318182418204"></p>
<h3 id="密钥的生成"><a href="#密钥的生成" class="headerlink" title="密钥的生成"></a>密钥的生成</h3><p>第一个函数是获取时间戳，第二个函数是对时间戳base64的变表加密，第三个异或运算得到密钥</p>
<h4 id="获取时间戳"><a href="#获取时间戳" class="headerlink" title="获取时间戳"></a>获取时间戳</h4><p>使用0x61624B82 演变得到一串数组</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220319151621929.png" alt="image-20220319151621929"></p>
<p>脚本：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">key = 0x61624B82</span><br><span class="line">a13 = 0</span><br><span class="line">a14 = 0</span><br><span class="line">while key:</span><br><span class="line">    a13 = key%10</span><br><span class="line">    key = key//10</span><br><span class="line">    a14 = 87</span><br><span class="line">    if a13&lt;=9:</span><br><span class="line">        a14 = 48</span><br><span class="line">    print(chr(a13+a14),end='')</span><br><span class="line">    </span><br><span class="line">obj = '0181383361'</span><br><span class="line">for i in range(len(obj)):</span><br><span class="line">    print(obj[len(obj)-1-i],end='')</span><br><span class="line"> </span><br><span class="line">得到的结果是 1633831810 这个字符串</span><br></pre></td></tr></tbody></table></figure>

<h4 id="魔改的base64加密"><a href="#魔改的base64加密" class="headerlink" title="魔改的base64加密"></a>魔改的base64加密</h4><p>用标准的base64加密这个字符串的结果是 MTYzMzgzMTgxMA== </p>
<p>分析本代码之中的base64加密 可以知道如果位数不是3的倍数位也是使用“=”</p>
<p>base64的变表</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZ=</span><br></pre></td></tr></tbody></table></figure>

<p>利用base64的变表和标准表的对应关系得到该代码base64加密的结果</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">oldkey = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span><br><span class="line">newkey = 'abcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZ='</span><br><span class="line">theMap = {}</span><br><span class="line">for i in range(len(oldkey)):</span><br><span class="line">    theMap[oldkey[i]] = newkey[i]</span><br><span class="line">advert = 'MTYzMzgzMTgxMA=='</span><br><span class="line">for i  in range(len(advert)):</span><br><span class="line">    print(theMap[advert[i]],end='')</span><br><span class="line">结果是：mtyNmN6Nmt6Lma==</span><br></pre></td></tr></tbody></table></figure>



<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220318191421527.png" alt="image-20220318191421527"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220318191436020.png" alt="image-20220318191436020"></p>
<h4 id="异或运算"><a href="#异或运算" class="headerlink" title="异或运算"></a>异或运算</h4><p>将上面base64的加密结果和字符串  “flag{this_is_fake_flag}”进行异或运算</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220319154418390.png" alt="image-20220319154418390"></p>
<p>脚本（密钥）：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tem1 = <span class="string">'mtyNmN6Nmt6Lma=='</span></span><br><span class="line">tem2 = <span class="string">'flag{this_is_fake_flag}'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tem1)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'0x'</span>+<span class="built_in">hex</span>(<span class="built_in">ord</span>(tem1[i])^<span class="built_in">ord</span>(tem2[i]))[<span class="number">2</span>:].zfill(<span class="number">2</span>),end=<span class="string">','</span>)</span><br><span class="line">[<span class="number">0x0b</span>,<span class="number">0x18</span>,<span class="number">0x18</span>,<span class="number">0x29</span>,<span class="number">0x16</span>,<span class="number">0x3a</span>,<span class="number">0x5e</span>,<span class="number">0x27</span>,<span class="number">0x1e</span>,<span class="number">0x2b</span>,<span class="number">0x5f</span>,<span class="number">0x3f</span>,<span class="number">0x32</span>,<span class="number">0x07</span>,<span class="number">0x5c</span>,<span class="number">0x56</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>得到的这个数组将会作为SM4加密的key</p>
<h3 id="SM4加密"><a href="#SM4加密" class="headerlink" title="SM4加密"></a><strong>SM4加密</strong></h3><blockquote>
<ol>
<li>识别出SM4加密</li>
<li>找到SM4加密魔改的地方</li>
</ol>
</blockquote>
<p>加密之后的结果和相应的数组对比</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220318193700160.png" alt="image-20220318193700160"></p>
<p>需要解密的对象是：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enc = [0xf7,0xeb,0x5e,0x87,0x17,0x9c,0x74,0x94,0x44,0xb5,0xf5,0x12,0xf9,0x74,0x15,0x5f]</span><br></pre></td></tr></tbody></table></figure>

<p>轮函数每次会处理128bite的数据，会将这128bite的数据分成4个32bite的数据</p>
<p>SM4加密，每组加密的是128bit，每32bit加密之后的顺序发生了变化的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220318193418765.png" alt="image-20220318193418765"></p>
<p>对每个8bit都用了s盒进行了处理，在内存之中找到s盒是</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    {0x48, 0x90, 0xE9, 0xFE, 0xCC, 0xE1, 0x3D, 0xB7, 0x16, 0xB6, 0x14, 0xC2, 0x28, 0xFB, 0x2C, 0x05},</span><br><span class="line">    {0x2B, 0x67, 0x9A, 0x76, 0x2A, 0xBE, 0x04, 0xC3, 0xAA, 0x44, 0x13, 0x26, 0x49, 0x86, 0x06, 0x99},</span><br><span class="line">    {0x9C, 0x42, 0x50, 0xF4, 0x91, 0xEF, 0x98, 0x7A, 0x33, 0x54, 0x0B, 0x43, 0xED, 0xCF, 0xAC, 0x62},</span><br><span class="line">    {0xE4, 0xB3, 0x1C, 0xA9, 0xC9, 0x08, 0xE8, 0x95, 0x80, 0xDF, 0x94, 0xFA, 0x75, 0x8F, 0x3F, 0xA6},</span><br><span class="line">    {0x47, 0x07, 0xA7, 0xFC, 0xF3, 0x73, 0x17, 0xBA, 0x83, 0x59, 0x3C, 0x19, 0xE6, 0x85, 0x4F, 0xA8},</span><br><span class="line">    {0x68, 0x6B, 0x81, 0xB2, 0x71, 0x64, 0xDA, 0x8B, 0xF8, 0xEB, 0x0F, 0x4B, 0x70, 0x56, 0x9D, 0x35},</span><br><span class="line">    {0x1E, 0x24, 0x0E, 0x5E, 0x63, 0x58, 0xD1, 0xA2, 0x25, 0x22, 0x7C, 0x3B, 0x01, 0x21, 0x78, 0x87},</span><br><span class="line">    {0xD4, 0x00, 0x46, 0x57, 0x9F, 0xD3, 0x27, 0x52, 0x4C, 0x36, 0x02, 0xE7, 0xA0, 0xC4, 0xC8, 0x9E},</span><br><span class="line">    {0xEA, 0xBF, 0x8A, 0xD2, 0x40, 0xC7, 0x38, 0xB5, 0xA3, 0xF7, 0xF2, 0xCE, 0xF9, 0x61, 0x15, 0xA1},</span><br><span class="line">    {0xE0, 0xAE, 0x5D, 0xA4, 0x9B, 0x34, 0x1A, 0x55, 0xAD, 0x93, 0x32, 0x30, 0xF5, 0x8C, 0xB1, 0xE3},</span><br><span class="line">    {0x1D, 0xF6, 0xE2, 0x2E, 0x82, 0x66, 0xCA, 0x60, 0xC0, 0x29, 0x23, 0xAB, 0x0D, 0x53, 0x4E, 0x6F},</span><br><span class="line">    {0xD5, 0xDB, 0x37, 0x45, 0xDE, 0xFD, 0x8E, 0x2F, 0x03, 0xFF, 0x6A, 0x72, 0x6D, 0x6C, 0x5B, 0x51},</span><br><span class="line">    {0x8D, 0x1B, 0xAF, 0x92, 0xBB, 0xDD, 0xBC, 0x7F, 0x11, 0xD9, 0x5C, 0x41, 0x1F, 0x10, 0x5A, 0xD8},</span><br><span class="line">    {0x0A, 0xC1, 0x31, 0x88, 0xA5, 0xCD, 0x7B, 0xBD, 0x2D, 0x74, 0xD0, 0x12, 0xB8, 0xE5, 0xB4, 0xB0},</span><br><span class="line">    {0x89, 0x69, 0x97, 0x4A, 0x0C, 0x96, 0x77, 0x7E, 0x65, 0xB9, 0xF1, 0x09, 0xC5, 0x6E, 0xC6, 0x84},</span><br><span class="line">    {0x18, 0xF0, 0x7D, 0xEC, 0x3A, 0xDC, 0x4D, 0x20, 0x79, 0xEE, 0x5F, 0x3E, 0xD7, 0xCB, 0x39, 0xD6}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">static const unsigned long CK[32] =</span><br><span class="line">{</span><br><span class="line">    0xF4BFE18F, 0xA8AA055C, 0x8B266D2B, 0xB3819D47, 0x0B1B3A85, 0xF7DB86B6, 0xC3279F82, 0x39D9C102,</span><br><span class="line">    0xBEA224C9, 0xE75D4DAC, 0xAC61726C, 0x6F98AA6F, 0xFA2ADA4E, 0x6A7CFF92, 0xA8066E7B, 0x7BE32F9F,</span><br><span class="line">    0x8CD0FED3, 0x4B98AF71, 0x790C2CBC, 0xBF880433, 0xAA46F582, 0x69C17A2C, 0x80BBD5E4, 0x24A02531,</span><br><span class="line">    0x293D87B3, 0x75F159AD, 0xB750AE9D, 0x9886928C, 0x05577A22, 0xB425E19F, 0x124D4F63, 0xE26F66D1</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<h3 id="SM4解密脚本"><a href="#SM4解密脚本" class="headerlink" title="SM4解密脚本"></a>SM4解密脚本</h3><p>网上找一个SM4的c语言脚本，修改里面的Sbox，CK参数，以及将上面得到的key和解密的对象引入（但是我从网上找了两个解密的脚本，修改了里面相应的参数之后，仍然得不到想要的结果，并且在内存之中也没能找到修改之后的CK参数，希望指点指点）</p>
<p>SM.h头部文件</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __lk_sm4_h__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __lk_sm4_h__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cpluscplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cpluscplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_WORD_SIZE        32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_GCHAR_SIZE       16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_GWORD_SIZE       4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>                LK_VOID;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span>                 LK_INT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>        UINT;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> i386</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>   UWORD;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span>       UWORD;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span>   UCHAR;</span><br><span class="line"></span><br><span class="line"><span class="comment">//大端转化</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_GE(c, i) (\</span></span><br><span class="line"><span class="meta">        (c[(i)+0] &lt;&lt; 24) | ((c[(i)+1] &lt;&lt; 16)) |\</span></span><br><span class="line"><span class="meta">         (c[(i)+2] &lt;&lt; 8) | (c[(i)+3]) )</span></span><br><span class="line"><span class="comment">//小端转化</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_LE(c, n, i) {\</span></span><br><span class="line"><span class="meta">        c[(i)+0] = ((n) &gt;&gt; 24) &amp; 0x000000ff;\</span></span><br><span class="line"><span class="meta">        c[(i)+1] = ((n) &gt;&gt; 16) &amp; 0x000000ff;\</span></span><br><span class="line"><span class="meta">        c[(i)+2] = ((n) &gt;&gt; 8) &amp; 0x000000ff;\</span></span><br><span class="line"><span class="meta">        c[(i)+3] = (n) &amp; 0x000000ff; }</span></span><br><span class="line"><span class="comment">//循环左移</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOOPSHFT(LK_LSHIFA, LK_LSHIFN) (\</span></span><br><span class="line"><span class="meta">        ((LK_LSHIFA) &lt;&lt; (LK_LSHIFN)) | \</span></span><br><span class="line"><span class="meta">        ((LK_LSHIFA) &gt;&gt; (LK_WORD_SIZE - (LK_LSHIFN))))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//线性变换函数L' L'(B)=B^(B&lt;&lt;&lt;13)^(B&lt;&lt;&lt;23)；</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_L0(LK_L0B) (\</span></span><br><span class="line"><span class="meta">    (LK_L0B)^(LOOPSHFT((LK_L0B), 13))^(LOOPSHFT((LK_L0B), 23)) )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//线性变换函数L L(B) = B^(B&lt;&lt;&lt;2)^(B&lt;&lt;&lt;10)^(B&lt;&lt;&lt;18)^(B&lt;&lt;&lt;24)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_L1(LK_L1B) (\</span></span><br><span class="line"><span class="meta">    (LK_L1B)^(LOOPSHFT((LK_L1B), 2))^(LOOPSHFT((LK_L1B), 10))\</span></span><br><span class="line"><span class="meta">    ^(LOOPSHFT((LK_L1B), 18))^(LOOPSHFT((LK_L1B), 24)) )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//非线性变换 τ函数 (b0 , b1, b2 , b3 ) = τ (A) = ( Sbox (a0 ), Sbox (a1 ), Sbox (a2 ), Sbox (a3 ) )</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_ST(LK_STA) ({\</span></span><br><span class="line"><span class="meta">    LK_INT LK_i;\</span></span><br><span class="line"><span class="meta">    UINT LK_STB = LK_STA;\</span></span><br><span class="line"><span class="meta">    UCHAR *pcr = (UCHAR *)(&amp;LK_STB);\</span></span><br><span class="line"><span class="meta">    for (LK_i = 0; LK_i &lt; 4; LK_i++) {\</span></span><br><span class="line"><span class="meta">        UCHAR high_bval = ((pcr[LK_i] &gt;&gt; 4) &amp; 0x0f);\</span></span><br><span class="line"><span class="meta">        UCHAR low_bval = (pcr[LK_i] &amp; 0x0f);\</span></span><br><span class="line"><span class="meta">        *(pcr+LK_i) = lk_sbox[high_bval][low_bval];\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">    LK_STB;\</span></span><br><span class="line"><span class="meta">})</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//合成置换 T  T(.)=L(τ(.))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_T1(LK_TA) (\</span></span><br><span class="line"><span class="meta">    LK_L1(LK_ST(LK_TA)) )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//合成置换 T'  T'(.)=L'(τ(.))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_T0(LK_TA) (\</span></span><br><span class="line"><span class="meta">    LK_L0(LK_ST(LK_TA)) )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//密钥扩展算法生成轮密钥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_SM4_INIT(lk_context, ekey) {\</span></span><br><span class="line"><span class="meta">    UINT k[36], mk[4];\</span></span><br><span class="line"><span class="meta">    LK_INT i;\</span></span><br><span class="line"><span class="meta">    lk_sm4_context_t *t = (lk_sm4_context_t *)(lk_context);\</span></span><br><span class="line"><span class="meta">    memset(t, 0,sizeof(lk_sm4_context_t));\</span></span><br><span class="line"><span class="meta">    for (i = 0; i &lt; 4; i++) {\</span></span><br><span class="line"><span class="meta">        mk[i] = LK_GE(ekey, i * 4);\</span></span><br><span class="line"><span class="meta">        k[i] = mk[i]^lk_fk[i];\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">    for (i = 0; i &lt; 32; i++) {\</span></span><br><span class="line"><span class="meta">        k[i+4] = (k[i] ^ LK_T0(k[i+1]^k[i+2]^k[i+3]^(lk_ck[i])));\</span></span><br><span class="line"><span class="meta">        t-&gt;e_rk[i] = k[i+4];\</span></span><br><span class="line"><span class="meta">        t-&gt;d_rk[31 - i] = t-&gt;e_rk[i];\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">}</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//加密函数</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_SM4_ENC_F(lk_context) {\</span></span><br><span class="line"><span class="meta">    LK_INT i;\</span></span><br><span class="line"><span class="meta">    UINT x[36];\</span></span><br><span class="line"><span class="meta">    lk_sm4_context_t *t = (lk_sm4_context_t *)(lk_context);\</span></span><br><span class="line"><span class="meta">    for (i = 0; i &lt; 4; i++) {\</span></span><br><span class="line"><span class="meta">        x[i] = LK_GE(t-&gt;buf, i * 4);\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">    for (i = 0; i &lt; 32; i++) {\</span></span><br><span class="line"><span class="meta">        x[i + 4] = x[i]^(LK_T1(x[i+1]^x[i+2]^x[i+3]^t-&gt;e_rk[i]));\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;ebuf, x[35], 0)\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;ebuf, x[34], 4)\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;ebuf, x[33], 8)\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;ebuf, x[32], 12)\</span></span><br><span class="line"><span class="meta">}</span></span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LK_SM4_DEC_F(lk_context) {\</span></span><br><span class="line"><span class="meta">    LK_INT i;\</span></span><br><span class="line"><span class="meta">    UINT x[36];\</span></span><br><span class="line"><span class="meta">    lk_sm4_context_t *t = (lk_sm4_context_t *)(lk_context);\</span></span><br><span class="line"><span class="meta">    for (i = 0; i &lt; 4; i++) {\</span></span><br><span class="line"><span class="meta">        x[i] = LK_GE(t-&gt;ebuf, i * 4);\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">    for (i = 0; i &lt; 32; i++) {\</span></span><br><span class="line"><span class="meta">        x[i + 4] = x[i]^LK_T1(x[i+1]^x[i+2]^x[i+3]^t-&gt;d_rk[i]);\</span></span><br><span class="line"><span class="meta">    }\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;buf, x[35], 0)\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;buf, x[34], 4)\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;buf, x[33], 8)\</span></span><br><span class="line"><span class="meta">    LK_LE(t-&gt;buf, x[32], 12)\</span></span><br><span class="line"><span class="meta">}</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">lk_sm4_context_s</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="comment">//需要加密的明文,加密之前需要填充</span></span><br><span class="line">    UCHAR    buf[LK_GCHAR_SIZE];</span><br><span class="line">    <span class="comment">//加密之后的密文,如果是解密的话,解密之前需要填充</span></span><br><span class="line">    UCHAR    ebuf[LK_GCHAR_SIZE];</span><br><span class="line">    <span class="comment">//原密钥经过扩展之后的轮密钥,初始化接口自行填充</span></span><br><span class="line">    UINT    e_rk[LK_WORD_SIZE];</span><br><span class="line">    <span class="comment">//解密过程需要的轮密钥,初始化接口自行填充</span></span><br><span class="line">    UINT    d_rk[LK_WORD_SIZE];</span><br><span class="line">} <span class="type">lk_sm4_context_t</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cpluscplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> LK_VOID <span class="title function_">lk_sm4_enc</span><span class="params">(LK_VOID *p_context)</span>;</span><br><span class="line"><span class="keyword">extern</span> LK_VOID <span class="title function_">lk_sm4_dec</span><span class="params">(LK_VOID *p_context)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cpluscplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>main.cpp</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include "SM4.h"</span></span><br><span class="line">//非线性转化用到的sbox对照表</span><br><span class="line">UCHAR lk_sbox[LK_GCHAR_SIZE][LK_GCHAR_SIZE] =  {</span><br><span class="line">    {<span class="number">0x48</span>, <span class="number">0x90</span>, <span class="number">0xE9</span>, <span class="number">0xFE</span>, <span class="number">0xCC</span>, <span class="number">0xE1</span>, <span class="number">0x3D</span>, <span class="number">0xB7</span>, <span class="number">0x16</span>, <span class="number">0xB6</span>, <span class="number">0x14</span>, <span class="number">0xC2</span>, <span class="number">0x28</span>, <span class="number">0xFB</span>, <span class="number">0x2C</span>, <span class="number">0x05</span>},</span><br><span class="line">    {<span class="number">0x2B</span>, <span class="number">0x67</span>, <span class="number">0x9A</span>, <span class="number">0x76</span>, <span class="number">0x2A</span>, <span class="number">0xBE</span>, <span class="number">0x04</span>, <span class="number">0xC3</span>, <span class="number">0xAA</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x99</span>},</span><br><span class="line">    {<span class="number">0x9C</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xF4</span>, <span class="number">0x91</span>, <span class="number">0xEF</span>, <span class="number">0x98</span>, <span class="number">0x7A</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0B</span>, <span class="number">0x43</span>, <span class="number">0xED</span>, <span class="number">0xCF</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>},</span><br><span class="line">    {<span class="number">0xE4</span>, <span class="number">0xB3</span>, <span class="number">0x1C</span>, <span class="number">0xA9</span>, <span class="number">0xC9</span>, <span class="number">0x08</span>, <span class="number">0xE8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xDF</span>, <span class="number">0x94</span>, <span class="number">0xFA</span>, <span class="number">0x75</span>, <span class="number">0x8F</span>, <span class="number">0x3F</span>, <span class="number">0xA6</span>},</span><br><span class="line">    {<span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xA7</span>, <span class="number">0xFC</span>, <span class="number">0xF3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xBA</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3C</span>, <span class="number">0x19</span>, <span class="number">0xE6</span>, <span class="number">0x85</span>, <span class="number">0x4F</span>, <span class="number">0xA8</span>},</span><br><span class="line">    {<span class="number">0x68</span>, <span class="number">0x6B</span>, <span class="number">0x81</span>, <span class="number">0xB2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xDA</span>, <span class="number">0x8B</span>, <span class="number">0xF8</span>, <span class="number">0xEB</span>, <span class="number">0x0F</span>, <span class="number">0x4B</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9D</span>, <span class="number">0x35</span>},</span><br><span class="line">    {<span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x0E</span>, <span class="number">0x5E</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xD1</span>, <span class="number">0xA2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7C</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>},</span><br><span class="line">    {<span class="number">0xD4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9F</span>, <span class="number">0xD3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4C</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xE7</span>, <span class="number">0xA0</span>, <span class="number">0xC4</span>, <span class="number">0xC8</span>, <span class="number">0x9E</span>},</span><br><span class="line">    {<span class="number">0xEA</span>, <span class="number">0xBF</span>, <span class="number">0x8A</span>, <span class="number">0xD2</span>, <span class="number">0x40</span>, <span class="number">0xC7</span>, <span class="number">0x38</span>, <span class="number">0xB5</span>, <span class="number">0xA3</span>, <span class="number">0xF7</span>, <span class="number">0xF2</span>, <span class="number">0xCE</span>, <span class="number">0xF9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xA1</span>},</span><br><span class="line">    {<span class="number">0xE0</span>, <span class="number">0xAE</span>, <span class="number">0x5D</span>, <span class="number">0xA4</span>, <span class="number">0x9B</span>, <span class="number">0x34</span>, <span class="number">0x1A</span>, <span class="number">0x55</span>, <span class="number">0xAD</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xF5</span>, <span class="number">0x8C</span>, <span class="number">0xB1</span>, <span class="number">0xE3</span>},</span><br><span class="line">    {<span class="number">0x1D</span>, <span class="number">0xF6</span>, <span class="number">0xE2</span>, <span class="number">0x2E</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xCA</span>, <span class="number">0x60</span>, <span class="number">0xC0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xAB</span>, <span class="number">0x0D</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>},</span><br><span class="line">    {<span class="number">0xD5</span>, <span class="number">0xDB</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xDE</span>, <span class="number">0xFD</span>, <span class="number">0x8E</span>, <span class="number">0x2F</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x6A</span>, <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0x6C</span>, <span class="number">0x5B</span>, <span class="number">0x51</span>},</span><br><span class="line">    {<span class="number">0x8D</span>, <span class="number">0x1B</span>, <span class="number">0xAF</span>, <span class="number">0x92</span>, <span class="number">0xBB</span>, <span class="number">0xDD</span>, <span class="number">0xBC</span>, <span class="number">0x7F</span>, <span class="number">0x11</span>, <span class="number">0xD9</span>, <span class="number">0x5C</span>, <span class="number">0x41</span>, <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x5A</span>, <span class="number">0xD8</span>},</span><br><span class="line">    {<span class="number">0x0A</span>, <span class="number">0xC1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xA5</span>, <span class="number">0xCD</span>, <span class="number">0x7B</span>, <span class="number">0xBD</span>, <span class="number">0x2D</span>, <span class="number">0x74</span>, <span class="number">0xD0</span>, <span class="number">0x12</span>, <span class="number">0xB8</span>, <span class="number">0xE5</span>, <span class="number">0xB4</span>, <span class="number">0xB0</span>},</span><br><span class="line">    {<span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4A</span>, <span class="number">0x0C</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0xB9</span>, <span class="number">0xF1</span>, <span class="number">0x09</span>, <span class="number">0xC5</span>, <span class="number">0x6E</span>, <span class="number">0xC6</span>, <span class="number">0x84</span>},</span><br><span class="line">    {<span class="number">0x18</span>, <span class="number">0xF0</span>, <span class="number">0x7D</span>, <span class="number">0xEC</span>, <span class="number">0x3A</span>, <span class="number">0xDC</span>, <span class="number">0x4D</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xEE</span>, <span class="number">0x5F</span>, <span class="number">0x3E</span>, <span class="number">0xD7</span>, <span class="number">0xCB</span>, <span class="number">0x39</span>, <span class="number">0xD6</span>}</span><br><span class="line">};</span><br><span class="line">//系统参数FK</span><br><span class="line">UINT lk_fk[<span class="number">4</span>] = {</span><br><span class="line">    <span class="number">0xA3B1BAC6</span>,<span class="number">0x56AA3350</span>,</span><br><span class="line">    <span class="number">0x677D9197</span>,<span class="number">0xB27022DC</span></span><br><span class="line">};</span><br><span class="line">//固定参数CK</span><br><span class="line">UINT lk_ck[<span class="number">32</span>] = {</span><br><span class="line"></span><br><span class="line">    <span class="number">0xF4BFE18F</span>, <span class="number">0xA8AA055C</span>, <span class="number">0x8B266D2B</span>, <span class="number">0xB3819D47</span>, <span class="number">0x0B1B3A85</span>, <span class="number">0xF7DB86B6</span>, <span class="number">0xC3279F82</span>, <span class="number">0x39D9C102</span>,</span><br><span class="line">    <span class="number">0xBEA224C9</span>, <span class="number">0xE75D4DAC</span>, <span class="number">0xAC61726C</span>, <span class="number">0x6F98AA6F</span>, <span class="number">0xFA2ADA4E</span>, <span class="number">0x6A7CFF92</span>, <span class="number">0xA8066E7B</span>, <span class="number">0x7BE32F9F</span>,</span><br><span class="line">    <span class="number">0x8CD0FED3</span>, <span class="number">0x4B98AF71</span>, <span class="number">0x790C2CBC</span>, <span class="number">0xBF880433</span>, <span class="number">0xAA46F582</span>, <span class="number">0x69C17A2C</span>, <span class="number">0x80BBD5E4</span>, <span class="number">0x24A02531</span>,</span><br><span class="line">    <span class="number">0x293D87B3</span>, <span class="number">0x75F159AD</span>, <span class="number">0xB750AE9D</span>, <span class="number">0x9886928C</span>, <span class="number">0x05577A22</span>, <span class="number">0xB425E19F</span>, <span class="number">0x124D4F63</span>, <span class="number">0xE26F66D1</span></span><br><span class="line"></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">LK_VOID lk_sm4_init(LK_VOID *p_context, UCHAR *ekey)</span><br><span class="line">{</span><br><span class="line">    //进行密钥扩展,生成轮转密钥rk</span><br><span class="line">    LK_SM4_INIT(p_context, ekey)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">LK_VOID lk_sm4_enc(LK_VOID *p_context)</span><br><span class="line">{</span><br><span class="line">    LK_SM4_ENC_F(p_context)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">LK_VOID lk_sm4_dec(LK_VOID *p_context)</span><br><span class="line">{</span><br><span class="line">    LK_SM4_DEC_F(p_context)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LK_INT main(LK_VOID)</span><br><span class="line">{</span><br><span class="line">    LK_INT i;</span><br><span class="line">    lk_sm4_context_t context;</span><br><span class="line">    UCHAR ekey[<span class="number">16</span>] = { <span class="number">0x0b</span>,<span class="number">0x18</span>,<span class="number">0x18</span>,<span class="number">0x29</span>,<span class="number">0x16</span>,<span class="number">0x3a</span>,<span class="number">0x5e</span>,<span class="number">0x27</span>,<span class="number">0x1e</span>,<span class="number">0x2b</span>,<span class="number">0x5f</span>,<span class="number">0x3f</span>,<span class="number">0x32</span>,<span class="number">0x07</span>,<span class="number">0x5c</span>,<span class="number">0x56</span> };</span><br><span class="line">    UCHAR data[<span class="number">16</span>] = { <span class="number">0xf7</span>,<span class="number">0xeb</span>,<span class="number">0x5e</span>,<span class="number">0x87</span>,<span class="number">0x17</span>,<span class="number">0x9c</span>,<span class="number">0x74</span>,<span class="number">0x94</span>,<span class="number">0x44</span>,<span class="number">0xb5</span>,<span class="number">0xf5</span>,<span class="number">0x12</span>,<span class="number">0xf9</span>,<span class="number">0x74</span>,<span class="number">0x15</span>,<span class="number">0x5f</span> };</span><br><span class="line">    //初始化</span><br><span class="line">    lk_sm4_init(&amp;context, ekey);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//    //待加密数据填充</span><br><span class="line">//    memcpy(context.buf, data, sizeof(data));</span><br><span class="line">//    //对数据进行加密</span><br><span class="line">//    lk_sm4_enc(&amp;context);</span><br><span class="line">//    //打印密文值</span><br><span class="line">//    printf(<span class="string">"enc data:"</span>);</span><br><span class="line">//    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; LK_GCHAR_SIZE; i++)</span><br><span class="line">//        printf(<span class="string">" %02x "</span>, context.ebuf[i]);</span><br><span class="line">//    printf(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">    //待解密的对象</span><br><span class="line">    printf(<span class="string">"enc data："</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; sizeof(data) ; i++)</span><br><span class="line">        printf(<span class="string">" %02x "</span>, data[i]);</span><br><span class="line">    printf(<span class="string">"\n"</span>);</span><br><span class="line">    //对数据进行解密</span><br><span class="line">    memcpy(context.ebuf, data, sizeof(data));</span><br><span class="line">    lk_sm4_dec(&amp;context);</span><br><span class="line">    //打印解密数据</span><br><span class="line">    printf(<span class="string">"dec data:"</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; LK_GCHAR_SIZE; i++)</span><br><span class="line">        printf(<span class="string">" %02x "</span>, context.buf[i]);</span><br><span class="line">    printf(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220320092347815.png" alt="image-20220320092347815"></p>
<p>misc  <a target="_blank" rel="noopener" href="https://jxswcy.top/da212791.html">DASCTF Oct X writeup | jxswcy’s blog</a></p>
<h2 id="魔法叠加"><a href="#魔法叠加" class="headerlink" title="魔法叠加"></a>魔法叠加</h2><p>知识点：</p>
<blockquote>
<ul>
<li>pyc文件头部（py3.7）</li>
<li>base91解密</li>
</ul>
</blockquote>
<h3 id="修改pyc头部"><a href="#修改pyc头部" class="headerlink" title="修改pyc头部"></a>修改pyc头部</h3><p>文件头部修改成如图所示 这里是python3.7</p>
<p>这个pyc是python3.7的版本 ，所以修改magic头部为 42 0D，后面34 改为32，因为要减去两个多出来的字节</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220319095943868.png" alt="image-20220319095943868"></p>
<p>在网上找到一个pyc的文件头部（对比着来修改）<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220319102000542.png" alt="image-20220319102000542"></p>
<h3 id="unemployee6反编译"><a href="#unemployee6反编译" class="headerlink" title="unemployee6反编译"></a>unemployee6反编译</h3><p>修改完pyc的文件头部之后，用unemployee6进行反编译（看到下面的命名方式，可以自行修改一下命名）</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.8.1.dev0</span></span><br><span class="line"><span class="comment"># Python bytecode 3.7.0 (3394)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.7.3 (v3.7.3:ef4ec6ed12, Mar 25 2019, 22:22:05) [MSC v.1916 64 bit (AMD64)]</span></span><br><span class="line"><span class="comment"># Embedded file name: ./2.py</span></span><br><span class="line"><span class="comment"># Compiled at: 2021-10-20 11:56:04</span></span><br><span class="line"><span class="comment"># Size of source mod 2**32: 1928 bytes</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">O0O00O00O00O0O00O = [</span><br><span class="line"> <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>, <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'U'</span>, <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'Z'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'!'</span>, <span class="string">'#'</span>, <span class="string">'$'</span>, <span class="string">'%'</span>, <span class="string">'&amp;'</span>, <span class="string">'('</span>, <span class="string">')'</span>, <span class="string">'*'</span>, <span class="string">'+'</span>, <span class="string">','</span>, <span class="string">'.'</span>, <span class="string">'/'</span>, <span class="string">':'</span>, <span class="string">';'</span>, <span class="string">'&lt;'</span>, <span class="string">'='</span>, <span class="string">'&gt;'</span>, <span class="string">'?'</span>, <span class="string">'@'</span>, <span class="string">'['</span>, <span class="string">']'</span>, <span class="string">'^'</span>, <span class="string">'_'</span>, <span class="string">'`'</span>, <span class="string">'{'</span>, <span class="string">'|'</span>, <span class="string">'}'</span>, <span class="string">'~'</span>, <span class="string">'"'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">O000O00000OO00OOO</span>):</span><br><span class="line">    <span class="string">""""""</span></span><br><span class="line">    OOOO00OOO00O000OO = <span class="number">0</span></span><br><span class="line">    OOOOOOOOOO00O0OOO = <span class="number">0</span></span><br><span class="line">    OO0OOO000000OOOOO = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> O0O0OO0OOOOOOOO00 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(O000O00000OO00OOO)):</span><br><span class="line">        O000O0OOOOO00O0O0 = O000O00000OO00OOO[O0O0OO0OOOOOOOO00:O0O0OO0OOOOOOOO00 + <span class="number">1</span>]</span><br><span class="line">        OOOO00OOO00O000OO |= struct.unpack(<span class="string">'B'</span>, O000O0OOOOO00O0O0)[<span class="number">0</span>] &lt;&lt; OOOOOOOOOO00O0OOO</span><br><span class="line">        OOOOOOOOOO00O0OOO += <span class="number">8</span></span><br><span class="line">        <span class="keyword">if</span> OOOOOOOOOO00O0OOO &gt; <span class="number">13</span>:</span><br><span class="line">            OO00O0OO00OOO000O = OOOO00OOO00O000OO &amp; <span class="number">8191</span></span><br><span class="line">            <span class="keyword">if</span> OO00O0OO00OOO000O &gt; <span class="number">88</span>:</span><br><span class="line">                OOOO00OOO00O000OO &gt;&gt;= <span class="number">13</span></span><br><span class="line">                OOOOOOOOOO00O0OOO -= <span class="number">13</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                OO00O0OO00OOO000O = OOOO00OOO00O000OO &amp; <span class="number">16383</span></span><br><span class="line">                OOOO00OOO00O000OO &gt;&gt;= <span class="number">14</span></span><br><span class="line">                OOOOOOOOOO00O0OOO -= <span class="number">14</span></span><br><span class="line">            OO0OOO000000OOOOO += O0O00O00O00O0O0O0[(OO00O0OO00OOO000O % <span class="number">91</span>)] + O0O00O00O00O0O0O0[(OO00O0OO00OOO000O // <span class="number">91</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> OOOOOOOOOO00O0OOO:</span><br><span class="line">        OO0OOO000000OOOOO += O0O00O00O00O0O0O0[(OOOO00OOO00O000OO % <span class="number">91</span>)]</span><br><span class="line">        <span class="keyword">if</span> OOOOOOOOOO00O0OOO &gt; <span class="number">7</span> <span class="keyword">or</span> OOOO00OOO00O000OO &gt; <span class="number">90</span>:</span><br><span class="line">            OO0OOO000000OOOOO += O0O00O00O00O0O0O0[(OOOO00OOO00O000OO // <span class="number">91</span>)]</span><br><span class="line">    <span class="keyword">return</span> OO0OOO000000OOOOO</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">O0O00O00O00O0O0O0 = []</span><br><span class="line">OO000O00O00O0O0O0 = []</span><br><span class="line">O0O0O0O0000O0O00O = <span class="built_in">input</span>(<span class="string">'plz input O0O0O0O0000O0O00O:\n'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">52</span>):</span><br><span class="line">    O0O00O00O00O0O0O0 = O0O00O00O00O0O00O[i:] + O0O00O00O00O0O00O[<span class="number">0</span>:i]</span><br><span class="line">    O0O0O0O0000O0O00O = encode(O0O0O0O0000O0O00O.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">dic = <span class="built_in">open</span>(<span class="string">'./00.txt'</span>, <span class="string">'a'</span>)</span><br><span class="line">dic.write(O0O0O0O0000O0O00O)</span><br><span class="line">dic.close</span><br><span class="line"><span class="comment"># okay decompiling D:\re\buuctf\buu\ħ������\magic.pyc</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>上面给的数组的长度是91 并且每次模的对象也是91，所以这里应该是[base91](<a target="_blank" rel="noopener" href="https://github.com/aberaud/base91-python">aberaud/base91-python: A python implementation of Base91 as described on http://base91.sourceforge.net/ (github.com)</a>)</p>
<p>整理得到</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line">key = [</span><br><span class="line"> 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '!', '#', '$', '%', '&amp;', '(', ')', '*', '+', ',', '.', '/', ':', ';', '&lt;', '=', '&gt;', '?', '@', '[', ']', '^', '_', '`', '{', '|', '}', '~', '"']</span><br><span class="line"></span><br><span class="line">def encode(num):</span><br><span class="line">    """"""</span><br><span class="line">    tem1 = 0</span><br><span class="line">    tem2 = 0</span><br><span class="line">    temstr = ''</span><br><span class="line">    for i in range(len(num)):</span><br><span class="line">        tem = num[i:i + 1]</span><br><span class="line">        tem1 |= struct.unpack('B', tem)[0] &lt;&lt; tem2</span><br><span class="line">        tem2 += 8</span><br><span class="line">        if tem2 &gt; 13:</span><br><span class="line">            tem0 = tem1 &amp; 8191</span><br><span class="line">            if tem0 &gt; 88:</span><br><span class="line">                tem1 &gt;&gt;= 13</span><br><span class="line">                tem2 -= 13</span><br><span class="line">            else:</span><br><span class="line">                tem0 = tem1 &amp; 16383</span><br><span class="line">                tem1 &gt;&gt;= 14</span><br><span class="line">                tem2 -= 14</span><br><span class="line">            temstr += key2[(tem0 % 91)] + key2[(tem0 // 91)]</span><br><span class="line"></span><br><span class="line">    if tem2:</span><br><span class="line">        temstr += key2[(tem1 % 91)]</span><br><span class="line">        if tem2 &gt; 7 or tem1 &gt; 90:</span><br><span class="line">            temstr += key2[(tem1 // 91)]</span><br><span class="line">    return temstr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key2 = []</span><br><span class="line">OO000O00O00O0O0O0 = []</span><br><span class="line">text = input('plz input text:\n')</span><br><span class="line">for i in range(0, 52):</span><br><span class="line">    key2 = key[i:] + key[0:i]</span><br><span class="line">    text = encode(text.encode('utf-8'))</span><br><span class="line"></span><br><span class="line">dic = open('./00.txt', 'a')</span><br><span class="line">dic.write(text)</span><br><span class="line">dic.close</span><br></pre></td></tr></tbody></table></figure>

<h3 id="base91的解密"><a href="#base91的解密" class="headerlink" title="base91的解密"></a>base91的解密</h3><p>加密解密base91的<strong>官方文档</strong>（注意每个函数参数类型）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line">base91_alphabet = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',</span><br><span class="line">	'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',</span><br><span class="line">	'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm',</span><br><span class="line">	'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',</span><br><span class="line">	'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '!', '#', '$',</span><br><span class="line">	'%', '&amp;', '(', ')', '*', '+', ',', '.', '/', ':', ';', '&lt;', '=',</span><br><span class="line">	'&gt;', '?', '@', '[', ']', '^', '_', '`', '{', '|', '}', '~', '"']</span><br><span class="line"></span><br><span class="line">decode_table = dict((v,k) for k,v in enumerate(base91_alphabet))</span><br><span class="line"></span><br><span class="line">def decode(encoded_str):</span><br><span class="line">    ''' Decode Base91 string to a bytearray '''</span><br><span class="line">    v = -1</span><br><span class="line">    b = 0</span><br><span class="line">    n = 0</span><br><span class="line">    out = bytearray()</span><br><span class="line">    for strletter in encoded_str:</span><br><span class="line">        if not strletter in decode_table:</span><br><span class="line">            continue</span><br><span class="line">        c = decode_table[strletter]</span><br><span class="line">        if(v &lt; 0):</span><br><span class="line">            v = c</span><br><span class="line">        else:</span><br><span class="line">            v += c*91</span><br><span class="line">            b |= v &lt;&lt; n</span><br><span class="line">            n += 13 if (v &amp; 8191)&gt;88 else 14</span><br><span class="line">            while True:</span><br><span class="line">                out += struct.pack('B', b&amp;255)</span><br><span class="line">                b &gt;&gt;= 8</span><br><span class="line">                n -= 8</span><br><span class="line">                if not n&gt;7:</span><br><span class="line">                    break</span><br><span class="line">            v = -1</span><br><span class="line">    if v+1:</span><br><span class="line">        out += struct.pack('B', (b | v &lt;&lt; n) &amp; 255 )</span><br><span class="line">    return out</span><br><span class="line"></span><br><span class="line">def encode(bindata):</span><br><span class="line">    ''' Encode a bytearray to a Base91 string '''</span><br><span class="line">    b = 0</span><br><span class="line">    n = 0</span><br><span class="line">    out = ''</span><br><span class="line">    for count in range(len(bindata)):</span><br><span class="line">        byte = bindata[count:count+1]</span><br><span class="line">        b |= struct.unpack('B', byte)[0] &lt;&lt; n</span><br><span class="line">        n += 8</span><br><span class="line">        if n&gt;13:</span><br><span class="line">            v = b &amp; 8191</span><br><span class="line">            if v &gt; 88:</span><br><span class="line">                b &gt;&gt;= 13</span><br><span class="line">                n -= 13</span><br><span class="line">            else:</span><br><span class="line">                v = b &amp; 16383</span><br><span class="line">                b &gt;&gt;= 14</span><br><span class="line">                n -= 14</span><br><span class="line">            out += base91_alphabet[v % 91] + base91_alphabet[v // 91]</span><br><span class="line">    if n:</span><br><span class="line">        out += base91_alphabet[b % 91]</span><br><span class="line">        if n&gt;7 or b&gt;90:</span><br><span class="line">            out += base91_alphabet[b // 91]</span><br><span class="line">    return out</span><br></pre></td></tr></tbody></table></figure>

<p>通过上面的循环我们可以知道一共进行了52次循环，所以利用对应每次变换得到的表进行每次的base91的解密</p>
<p>脚本：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line">base91_alphabet = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',</span><br><span class="line">	'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',</span><br><span class="line">	'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm',</span><br><span class="line">	'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',</span><br><span class="line">	'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '!', '#', '$',</span><br><span class="line">	'%', '&amp;', '(', ')', '*', '+', ',', '.', '/', ':', ';', '&lt;', '=',</span><br><span class="line">	'&gt;', '?', '@', '[', ']', '^', '_', '`', '{', '|', '}', '~', '"']</span><br><span class="line"></span><br><span class="line">def decode(encoded_str):</span><br><span class="line">    ''' Decode Base91 string to a bytearray '''</span><br><span class="line">    v = -1</span><br><span class="line">    b = 0</span><br><span class="line">    n = 0</span><br><span class="line">    out = b''</span><br><span class="line">    for strletter in encoded_str():   </span><br><span class="line">        if not strletter in decode_table:</span><br><span class="line">            continue</span><br><span class="line">        c = decode_table[strletter]</span><br><span class="line">        if(v &lt; 0):</span><br><span class="line">            v = c</span><br><span class="line">        else:</span><br><span class="line">            v += c*91</span><br><span class="line">            b |= v &lt;&lt; n</span><br><span class="line">            n += 13 if (v &amp; 8191)&gt;88 else 14</span><br><span class="line">            while True:</span><br><span class="line">                out += struct.pack('B', b&amp;255)</span><br><span class="line">                b &gt;&gt;= 8</span><br><span class="line">                n -= 8</span><br><span class="line">                if not n&gt;7:</span><br><span class="line">                    break</span><br><span class="line">            v = -1</span><br><span class="line">    if v+1:</span><br><span class="line">        out += struct.pack('B', (b | v &lt;&lt; n) &amp; 255 )</span><br><span class="line">    return out</span><br><span class="line"></span><br><span class="line">with open("D:\\re\\buuctf\\buu\魔法叠加\\00.txt",'rb') as f:</span><br><span class="line">    data = f.read()</span><br><span class="line">for i in range(51,-1,-1):</span><br><span class="line">    tem  = base91_alphabet[i:] + base91_alphabet[0:i]</span><br><span class="line">    decode_table = dict((v, k) for k, v in enumerate(tem))</span><br><span class="line">    data = decode(data.decode()) # 该函数之中传入的参数应该是字符串型 但是我们得到的是byte类型 所以需要decoed() 将byte转换成string类型的数据</span><br><span class="line">    print(i)</span><br><span class="line">print(data)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>注意byte 和 石头人相互转换的方法：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># str to bytes</span><br><span class="line"> str.encode(s)</span><br><span class="line"></span><br><span class="line"> # bytes to str</span><br><span class="line"> bytes.decode(b)</span><br></pre></td></tr></tbody></table></figure>

<p>因为解密的长度太长了，所以就直接用别人跑出来的结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/DASCTF-Oct/image-20220319124833684.png" alt="image-20220319124833684"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Gruge</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/03/20/DASCTF-Oct/">http://example.com/2022/03/20/DASCTF-Oct/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Gruge's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/base91%E8%A7%A3%E5%AF%86/">base91解密</a><a class="post-meta__tags" href="/tags/SM4%E8%A7%A3%E5%AF%86/">SM4解密</a></div><div class="post_share"><div class="social-share" data-image="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/29/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">陇原战疫2021网络安全大赛</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/17/frida-d3mug%E5%A4%8D%E7%8E%B0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">frida+d3mug复现</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/463b631c6a0f63ec.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">Gruge</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DASCTF-Oct-re"><span class="toc-number">1.</span> <span class="toc-text">DASCTF_Oct_re</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%AC%E7%8C%B4%E7%83%A7%E9%85%92"><span class="toc-number">1.1.</span> <span class="toc-text">马猴烧酒</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-number">1.1.1.</span> <span class="toc-text">密钥的生成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">获取时间戳</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AD%94%E6%94%B9%E7%9A%84base64%E5%8A%A0%E5%AF%86"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">魔改的base64加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">异或运算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SM4%E5%8A%A0%E5%AF%86"><span class="toc-number">1.1.2.</span> <span class="toc-text">SM4加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SM4%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-number">1.1.3.</span> <span class="toc-text">SM4解密脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AD%94%E6%B3%95%E5%8F%A0%E5%8A%A0"><span class="toc-number">1.2.</span> <span class="toc-text">魔法叠加</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9pyc%E5%A4%B4%E9%83%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">修改pyc头部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unemployee6%E5%8F%8D%E7%BC%96%E8%AF%91"><span class="toc-number">1.2.2.</span> <span class="toc-text">unemployee6反编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base91%E7%9A%84%E8%A7%A3%E5%AF%86"><span class="toc-number">1.2.3.</span> <span class="toc-text">base91的解密</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/13/starCTF/" title="starCTF"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="starCTF"></a><div class="content"><a class="title" href="/2022/04/13/starCTF/" title="starCTF">starCTF</a><time datetime="2022-04-13T01:20:26.000Z" title="发表于 2022-04-13 09:20:26">2022-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/05/2022DASCTF-X-SU-StarGate/" title="2022DASCTF_X_SU_StarGate"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022DASCTF_X_SU_StarGate"></a><div class="content"><a class="title" href="/2022/04/05/2022DASCTF-X-SU-StarGate/" title="2022DASCTF_X_SU_StarGate">2022DASCTF_X_SU_StarGate</a><time datetime="2022-04-05T14:46:18.000Z" title="发表于 2022-04-05 22:46:18">2022-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/29/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" title="陇原战疫2021网络安全大赛"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="陇原战疫2021网络安全大赛"></a><div class="content"><a class="title" href="/2022/03/29/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" title="陇原战疫2021网络安全大赛">陇原战疫2021网络安全大赛</a><time datetime="2022-03-29T05:20:37.000Z" title="发表于 2022-03-29 13:20:37">2022-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/20/DASCTF-Oct/" title="DASCTF_Oct"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DASCTF_Oct"></a><div class="content"><a class="title" href="/2022/03/20/DASCTF-Oct/" title="DASCTF_Oct">DASCTF_Oct</a><time datetime="2022-03-20T01:53:18.000Z" title="发表于 2022-03-20 09:53:18">2022-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/17/frida-d3mug%E5%A4%8D%E7%8E%B0/" title="frida+d3mug复现"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s3.bmp.ovh/imgs/2022/02/ca6f47126f533a59.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="frida+d3mug复现"></a><div class="content"><a class="title" href="/2022/03/17/frida-d3mug%E5%A4%8D%E7%8E%B0/" title="frida+d3mug复现">frida+d3mug复现</a><time datetime="2022-03-17T04:21:15.000Z" title="发表于 2022-03-17 12:21:15">2022-03-17</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2022 By Gruge</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '1aa3bac2fd8cfac9d7c3',
      clientSecret: '7640d6d45e9030f665c75a640991b67e8367e67d',
      repo: 'G2uge.github.io',
      owner: 'G2uge',
      admin: ['G2uge'],
      id: '006da14ca1653d854494ad1403554b9e',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>